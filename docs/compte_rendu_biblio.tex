\documentclass[12pt,a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[french]{babel}
\usepackage{geometry}
\usepackage{graphicx}
\usepackage{fancyhdr}
\usepackage{listings}
\usepackage{xcolor}
\usepackage{float}
\usepackage{enumitem}
\usepackage{booktabs}
\usepackage{multirow}
\usepackage{tcolorbox}
\usepackage{hyperref}
\usepackage{longtable}
\usepackage{tabularx}

% Setup for graphics path
\graphicspath{{diagrammes/}}

\geometry{margin=2.5cm}
\pagestyle{fancy}
\fancyhf{}
\fancyhead[L]{\leftmark}
\fancyhead[R]{\thepage}

\lstset{
    language=PHP,
    basicstyle=\ttfamily\footnotesize,
    keywordstyle=\color{blue},
    commentstyle=\color{green!60!black},
    stringstyle=\color{red},
    numbers=left,
    numberstyle=\tiny,
    frame=single,
    breaklines=true,
    captionpos=b
}

\begin{document}

% Page de garde
\begin{titlepage}
    \centering
    \vspace*{2cm}

    {\LARGE \textbf{L'Institut Supérieur des Études Technologiques de Sfax}}\\[0.3cm]
    {\LARGE \textbf{ISET Sfax}}\\[0.5cm]
    {\large Département Technologies de l'Informatique}\\[3cm]

    {\Huge\bfseries Compte Rendu\par}
    \vspace{0.5cm}
    {\LARGE Mini-Projet\par}
    \vspace{0.3cm}
    {\Large Biblio - Système de Gestion de Bibliothèque\par}
    \vspace{3cm}

    \begin{tcolorbox}[colback=blue!5!white,colframe=blue!75!black,title=Objectifs du Projet]
    \begin{itemize}
        \item Développer un système complet de gestion de bibliothèque
        \item Implémenter un workflow de prêt et réservation de livres
        \item Créer un système e-commerce avec paiement Stripe
        \item Développer un système de messagerie interne
        \item Fournir une interface utilisateur moderne et responsive
        \item Mettre en place une double interface d'administration (EasyAdmin + Custom)
        \item Implémenter un système de suivi de progression de lecture
        \item Gérer les stocks séparément pour vente et emprunt
    \end{itemize}
    \end{tcolorbox}

    \vfill

    {\large \textbf{Matière:}} Framework web avancé\\[0.3cm]
    {\large \textbf{Enseignant:}} M. Faiez Charfi\\[1cm]

    {\large \textbf{Réalisé par:}}\\[0.3cm]
    {\large Ahmed Khlif}\\[0.2cm]
    {\large Classe: GLNT}\\[1.5cm]

    {\large Année Universitaire: 2025/2026}

    \vspace{1cm}

    {\large \textbf{Dépôt GitHub:}} \\
    \href{https://github.com/ahmedKhlif/biblio_Symfony}{https://github.com/ahmedKhlif/biblio\_Symfony}

\end{titlepage}

% Nouvelle page pour le contenu
\newpage
\tableofcontents
\newpage

\section{Présentation du Projet}

\subsection{Contexte et Objectifs}

Biblio est un système de gestion de bibliothèque complet et prêt pour la production, développé avec Symfony 7 et PHP 8.2+. Ce mini-projet démontre l'implémentation d'une solution moderne pour la gestion d'une bibliothèque numérique avec des fonctionnalités avancées.

\textbf{Objectifs principaux :}
\begin{itemize}
    \item Développer un système de gestion de bibliothèque fonctionnel
    \item Implémenter un workflow complet de prêt de livres
    \item Créer un système de réservation avec file d'attente
    \item Intégrer un module e-commerce avec paiement Stripe
    \item Développer un système de messagerie interne
    \item Fournir une interface utilisateur moderne et responsive
    \item Mettre en place une double interface d'administration
    \item Gérer les stocks de manière intelligente (vente vs emprunt)
\end{itemize}

\subsection{Références}

\begin{itemize}
    \item \textbf{Dépôt GitHub} : \href{https://github.com/ahmedKhlif/biblio_Symfony}{https://github.com/ahmedKhlif/biblio\_Symfony}
    \item \textbf{Technologies} : Symfony 7, PHP 8.2+, Doctrine ORM, MySQL
    \item \textbf{Framework Frontend} : Bootstrap 4, jQuery, FullCalendar.js
    \item \textbf{Intégrations} : Stripe (paiements), SMTP (emails), Turbo/Hotwire
    \item \textbf{Admin} : EasyAdmin 4, SB Admin 2 (personnalisé)
\end{itemize}

\section{Analyse Fonctionnelle}

\subsection{Acteurs du Système}

\subsubsection{L'Utilisateur (User)}
\begin{itemize}
    \item Navigation et consultation du catalogue de livres
    \item Recherche avancée avec filtres (auteur, catégorie, éditeur)
    \item Gestion du panier d'achat avec validation de stock
    \item Processus de commande avec paiement Stripe
    \item Demande d'emprunt de livres
    \item Réservation de livres indisponibles
    \item Consultation du calendrier de disponibilité
    \item Suivi de progression de lecture
    \item Gestion des objectifs de lecture
    \item Messagerie interne avec autres utilisateurs
    \item Rédaction d'avis et notes sur les livres
    \item Gestion du profil et liste de souhaits
\end{itemize}

\subsubsection{L'Administrateur (Admin)}
\begin{itemize}
    \item Gestion complète des livres (CRUD)
    \item Gestion des auteurs, catégories et éditeurs
    \item Approbation et gestion des demandes de prêt
    \item Gestion de la file d'attente des réservations
    \item Gestion des utilisateurs et rôles
    \item Consultation des statistiques et analytics
    \item Gestion des bannières promotionnelles
    \item Consultation des journaux d'activité
    \item Gestion des commandes et paiements
    \item Modération des avis utilisateurs
\end{itemize}

\subsection{Diagramme des Cas d'Utilisation}

Le diagramme suivant présente les cas d'utilisation principaux du système :

\begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth]{01_usecases.png}
    \caption{Diagramme Complet des Cas d'Utilisation}
    \label{fig:usecases}
\end{figure}
        UC22[Noter un livre]
    end
    
    subgraph "Communication"
        UC23[Envoyer un message]
        UC24[Consulter les messages]
    end
    
    V --> UC1
    V --> UC2
    V --> UC3
    
    U --> UC5
    U --> UC6
    U --> UC8
    U --> UC9
    U --> UC10
    U --> UC11
    U --> UC14
    U --> UC15
    U --> UC16
    U --> UC17
    U --> UC19
    U --> UC20
    U --> UC21
    U --> UC22
    U --> UC23
    U --> UC24
    
    A --> UC4
    A --> UC7
    A --> UC12
    A --> UC13
    A --> UC18

\subsection{Diagramme de Séquence - Processus de Prêt}

\begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth]{02_loan_sequence.png}
    \caption{Diagramme de Séquence Complet du Processus de Prêt}
    \label{fig:loan_sequence}
\end{figure}

\subsection{Diagramme de Séquence - Processus d'Achat}

\begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth]{03_ecommerce_sequence.png}
    \caption{Diagramme de Séquence Complet du Processus d'Achat}
    \label{fig:ecommerce_sequence}
\end{figure}

\section{Architecture Technique}

\subsection{Architecture MVC}

L'application suit strictement le pattern Modèle-Vue-Contrôleur de Symfony :

\begin{itemize}
    \item \textbf{Couche Modèle (Entity)} : 18 entités Doctrine représentant les données
    \item \textbf{Couche Vue (Templates)} : Templates Twig pour le rendu HTML
    \item \textbf{Couche Contrôleur} : 35+ contrôleurs gérant la logique métier
    \item \textbf{Couche Service} : 7 services pour la logique réutilisable
    \item \textbf{Couche Repository} : Requêtes Doctrine personnalisées
\end{itemize}

\subsection{Diagramme d'Architecture}

\begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth]{07_architecture.png}
    \caption{Architecture Complète de Biblio}
    \label{fig:architecture}
\end{figure}
    
    subgraph "Data Layer"
        ORM[Doctrine ORM]
        DB[(MySQL Database)]
        REPO[Repositories]
    end
    
    subgraph "External Services"
        STRIPE[Stripe API]
        SMTP[SMTP Server]
    end
    
    B --> PC
    JS --> API
    FC --> UC
    TU --> PC
    
    PC --> ES
    UC --> SS
    AC --> AL
    
    PC --> ORM
    UC --> ORM
    AC --> ORM
    
    ORM --> DB
    REPO --> ORM
    
    SS --> STRIPE
    ES --> SMTP
```
\end{verbatim}

\subsection{Technologies Implémentées}

\subsubsection{Backend - Symfony 7}
\begin{itemize}
    \item Symfony 7.3 : Framework web principal
    \item PHP 8.2+ : Langage de programmation moderne avec types stricts
    \item Doctrine ORM 3.x : Couche d'accès base de données
    \item EasyAdmin 4.x : Générateur d'interface d'administration
    \item Symfony Security : Authentification et autorisation
    \item Symfony Mailer : Service d'envoi d'emails
    \item Symfony Form : Gestion des formulaires
    \item Symfony Validator : Validation des données
    \item KnpPaginatorBundle : Pagination des listes
    \item Stripe PHP SDK : Intégration paiements
\end{itemize}

\subsubsection{Frontend - Interface Utilisateur}
\begin{itemize}
    \item Twig 3.x : Moteur de templates
    \item Bootstrap 4.x : Framework CSS responsive
    \item jQuery 3.x : Bibliothèque JavaScript
    \item FullCalendar.js 6.x : Calendrier interactif
    \item Font Awesome 5.x : Bibliothèque d'icônes
    \item SB Admin 2 : Template de dashboard admin
    \item Turbo/Hotwire : Navigation SPA-like sans rechargement complet
    \item Stimulus : Contrôleurs JavaScript modulaires
\end{itemize}

\subsubsection{Base de Données}
\begin{itemize}
    \item MySQL/MariaDB : Système de gestion de base de données
    \item 25 migrations Doctrine : Gestion évolutive du schéma
    \item 18 entités : Modèle de données complet
    \item Relations complexes : OneToMany, ManyToMany, ManyToOne
\end{itemize}

\section{Modèle de Données}

\subsection{Diagramme Entité-Relation}

\begin{figure}[H]
    \centering
    \includegraphics[width=\textwidth]{08_erd.png}
    \caption{Schéma Entité-Relation Complet de Biblio}
    \label{fig:erd}
\end{figure}

\subsection{Entités Principales}

\begin{table}[H]
\centering
\caption{Liste des 18 Entités du Système}
\begin{tabular}{|l|l|p{6cm}|}
\hline
\textbf{Entité} & \textbf{Table} & \textbf{Description} \\
\hline
User & user & Utilisateurs avec rôles et profils \\
\hline
Livre & livre & Livres avec double stock (vente/emprunt) \\
\hline
Auteur & auteur & Auteurs avec biographie \\
\hline
Categorie & categorie & Catégories de livres \\
\hline
Editeur & editeur & Éditeurs/Maisons d'édition \\
\hline
Loan & loans & Prêts avec workflow de statuts \\
\hline
BookReservation & book\_reservations & Réservations avec position file \\
\hline
Cart & carts & Paniers d'achat utilisateurs \\
\hline
CartItem & cart\_item & Articles du panier \\
\hline
Order & orders & Commandes avec paiement \\
\hline
OrderItem & order\_item & Lignes de commande \\
\hline
Review & review & Avis et notes des livres \\
\hline
Message & message & Messages internes \\
\hline
ReadingProgress & reading\_progress & Progression de lecture \\
\hline
ReadingGoal & reading\_goal & Objectifs de lecture \\
\hline
Banner & banner & Bannières promotionnelles \\
\hline
ActivityLog & activity\_log & Journal d'activité \\
\hline
UserBannerPreference & user\_banner\_pref & Préférences bannières \\
\hline
\end{tabular}
\end{table}

\subsection{Système de Stock Double}

Une innovation majeure du projet est la séparation du stock en deux catégories distinctes :

\begin{lstlisting}[language=PHP, caption=Entité Livre - Champs de Stock]
#[ORM\Column(type: 'integer', options: ['default' => 0])]
private int $stockVente = 0;

#[ORM\Column(type: 'integer', options: ['default' => 0])]
private int $stockEmprunt = 0;

public function getTotalStock(): int
{
    return $this->stockVente + $this->stockEmprunt;
}

public function isAvailableForSale(): bool
{
    return $this->stockVente > 0;
}

public function getAvailableLoanCopies(): int
{
    $activeLoans = $this->loans->filter(
        fn($loan) => in_array($loan->getStatus(), 
            ['requested', 'approved', 'active'])
    )->count();
    return max(0, $this->stockEmprunt - $activeLoans);
}
\end{lstlisting}

\textbf{Avantages du système :}
\begin{itemize}
    \item Gestion indépendante des stocks vente et emprunt
    \item Pas de conflit entre achats et emprunts
    \item Calcul automatique du total des exemplaires
    \item Validation précise de la disponibilité par type d'opération
\end{itemize}

\section{Fonctionnalités Implémentées}

\subsection{Gestion des Utilisateurs et Authentification}

\subsubsection{Système d'Inscription et Connexion}
\begin{itemize}
    \item Inscription avec validation des données
    \item Confirmation par email avec token sécurisé
    \item Connexion sécurisée avec gestion des sessions
    \item Récupération de mot de passe par email
    \item Système de rôles (ROLE\_USER, ROLE\_ADMIN)
    \item Hiérarchie de rôles configurée
\end{itemize}

\subsubsection{Gestion des Profils}
\begin{itemize}
    \item Modification des informations personnelles
    \item Upload d'avatar utilisateur
    \item Gestion des adresses (facturation/livraison)
    \item Liste de souhaits (wishlist)
    \item Livres possédés
    \item Auteurs favoris
\end{itemize}

\subsection{Gestion du Catalogue de Livres}

\subsubsection{Recherche et Filtrage}
\begin{itemize}
    \item Recherche full-text par mots-clés
    \item Filtrage par auteur, catégorie, éditeur
    \item Tri par date, prix, titre
    \item Pagination des résultats avec KnpPaginator
    \item Autocomplétion AJAX pour la recherche
\end{itemize}

\subsubsection{Gestion des Livres (Admin)}
\begin{itemize}
    \item CRUD complet via EasyAdmin
    \item Upload d'images de couverture
    \item Upload de fichiers PDF
    \item Gestion du double stock (vente/emprunt)
    \item Association avec auteur, catégorie, éditeur
    \item Drapeau "empruntable" pour contrôler les prêts
\end{itemize}

\subsection{Système de Prêt}

\subsubsection{Workflow de Prêt}
\begin{enumerate}
    \item \textbf{Demande (requested)} : L'utilisateur demande un emprunt
    \item \textbf{Approbation (approved)} : L'admin approuve la demande
    \item \textbf{Actif (active)} : Le livre est en cours d'emprunt
    \item \textbf{Retourné (returned)} : Le livre est rendu
    \item \textbf{En retard (overdue)} : Dépassement de la date d'échéance
    \item \textbf{Annulé (cancelled)} : Demande annulée
\end{enumerate}

\begin{verbatim}
```mermaid
stateDiagram-v2
    [*] --> requested : Demande d'emprunt
    requested --> approved : Admin approuve
    requested --> cancelled : Admin refuse / User annule
    approved --> active : Livre remis
    active --> returned : Livre retourné
    active --> overdue : Date dépassée
    overdue --> returned : Livre retourné (retard)
    returned --> [*]
    cancelled --> [*]
```
\end{verbatim}

\subsubsection{Fonctionnalités du Prêt}
\begin{itemize}
    \item Période de prêt automatique de 14 jours
    \item Calcul automatique de la date d'échéance
    \item Validation du stock d'emprunt disponible
    \item Historique complet des prêts
    \item Notes et commentaires sur les prêts
    \item Commande de rappel pour livres en retard
\end{itemize}

\subsection{Système de Réservation}

\subsubsection{File d'Attente}
\begin{itemize}
    \item Création de réservation quand stock emprunt = 0
    \item Attribution automatique de position dans la file
    \item Notification quand le livre devient disponible
    \item Conversion automatique en prêt possible
    \item Calendrier de disponibilité avec dates estimées
\end{itemize}

\subsubsection{Calendrier de Disponibilité}
\begin{itemize}
    \item Intégration FullCalendar.js
    \item Affichage des emprunts actifs
    \item Dates de retour prévues
    \item Compatible avec Turbo/Hotwire
    \item Mise à jour en temps réel
\end{itemize}

\subsection{Module E-Commerce}

\subsubsection{Panier d'Achat}
\begin{itemize}
    \item Ajout/suppression de produits
    \item Mise à jour des quantités
    \item Validation automatique contre stockVente
    \item Calcul automatique des totaux
    \item Persistance en base de données
\end{itemize}

\subsubsection{Processus de Commande}
\begin{itemize}
    \item Validation du stock disponible
    \item Saisie des adresses de livraison/facturation
    \item Sélection du mode de paiement
    \item Intégration Stripe pour paiement sécurisé
    \item Génération de numéro de commande unique
    \item Email de confirmation automatique
    \item Mise à jour du stockVente après paiement
\end{itemize}

\subsubsection{Statuts de Commande}
\begin{verbatim}
```mermaid
stateDiagram-v2
    [*] --> pending : Commande créée
    pending --> paid : Paiement confirmé
    pending --> cancelled : Annulation
    paid --> processing : En préparation
    processing --> shipped : Expédiée
    processing --> cancelled : Annulation
    shipped --> delivered : Livrée
    delivered --> refunded : Remboursement
    delivered --> [*]
    cancelled --> [*]
    refunded --> [*]
```
\end{verbatim}

\subsection{Système d'Avis et Notes}

\begin{itemize}
    \item Notes de 1 à 5 étoiles
    \item Commentaires textuels optionnels
    \item Upload d'images dans les avis
    \item Badge "Achat vérifié"
    \item Votes "Utile" par la communauté
    \item Modération par l'administrateur
\end{itemize}

\subsection{Suivi de Progression de Lecture}

\begin{itemize}
    \item Pourcentage de progression par livre
    \item Page courante enregistrée
    \item Système de signets avec notes
    \item Statut de complétion automatique
    \item Historique de lecture (lastReadAt)
\end{itemize}

\subsection{Objectifs de Lecture}

\begin{itemize}
    \item Types d'objectifs : livres/an, pages/mois, personnalisé
    \item Valeur cible vs valeur actuelle
    \item Dates de début et fin
    \item Pourcentage de progression calculé
    \item Notifications d'accomplissement
\end{itemize}

\subsection{Messagerie Interne}

\begin{itemize}
    \item Communication utilisateur à utilisateur
    \item Statut de lecture avec horodatage
    \item Compteur de messages non lus (AJAX)
    \item Affichage du temps relatif en français
    \item Boîte de réception et messages envoyés
\end{itemize}

\subsection{Système de Bannières}

\begin{itemize}
    \item Types : promotion, announcement, warning, info
    \item Positions : top, bottom, sidebar, popup
    \item Planification avec dates de début/fin
    \item Ciblage par rôle utilisateur
    \item Style personnalisé (couleurs, CSS)
    \item Option "fermer" avec mémorisation
\end{itemize}

\subsection{Double Interface d'Administration}

\subsubsection{EasyAdmin 4 (/admin)}
\begin{itemize}
    \item CRUD automatique pour les 18 entités
    \item Dashboard avec statistiques
    \item Filtres et recherche avancée
    \item Actions par lot
    \item Export de données
\end{itemize}

\subsubsection{SB Admin 2 Personnalisé (/backoffice)}
\begin{itemize}
    \item Tableaux de bord visuels
    \item Graphiques et charts
    \item Gestion des prêts avec workflow
    \item Gestion des réservations avec file d'attente
    \item Statistiques avancées
\end{itemize}

\section{Structure du Projet}

\subsection{Arborescence des Fichiers}

\begin{lstlisting}[language=bash, caption=Structure du Projet]
biblio/
|-- assets/                    # Assets frontend
|   |-- app.js                 # JavaScript principal
|   |-- styles/                # Fichiers CSS/SCSS
|   |-- controllers/           # Controleurs Stimulus
|-- bin/
|   |-- console                # Console Symfony
|-- config/
|   |-- packages/              # Configuration bundles
|   |-- routes/                # Configuration routes
|   |-- services.yaml          # Services DI
|-- migrations/                # 25 migrations Doctrine
|-- public/
|   |-- index.php              # Point d'entree
|   |-- uploads/               # Fichiers uploades
|-- src/
|   |-- Command/               # Commandes console
|   |-- Controller/            # 35+ controleurs
|   |   |-- Admin/             # 20 CRUD EasyAdmin
|   |-- DataFixtures/          # Donnees de test
|   |-- Entity/                # 18 entites
|   |-- EventListener/         # Listeners
|   |-- EventSubscriber/       # Subscribers
|   |-- Form/                  # Types de formulaires
|   |-- Repository/            # Repositories Doctrine
|   |-- Security/              # Composants securite
|   |-- Service/               # 7 services metier
|-- templates/                 # Templates Twig
|   |-- admin/                 # Templates admin
|   |-- borrowing/             # Templates emprunt
|   |-- reservation/           # Templates reservation
|   |-- emails/                # Templates emails
|-- tests/                     # Tests unitaires
|-- translations/              # Fichiers i18n
\end{lstlisting}

\subsection{Contrôleurs Principaux}

\begin{table}[H]
\centering
\caption{Liste des Contrôleurs}
\begin{tabular}{|l|p{8cm}|}
\hline
\textbf{Contrôleur} & \textbf{Responsabilité} \\
\hline
LivreController & Catalogue et détails des livres \\
\hline
BorrowingController & Demandes d'emprunt, calendrier \\
\hline
ReservationController & Réservations utilisateur \\
\hline
CartController & Gestion du panier \\
\hline
CheckoutController & Processus de paiement \\
\hline
OrderController & Historique des commandes \\
\hline
LoanManagementController & Admin: gestion des prêts \\
\hline
ReservationManagementController & Admin: gestion des réservations \\
\hline
MessageController & Messagerie interne \\
\hline
ProfileController & Profil utilisateur \\
\hline
ReadingProgressController & Suivi de lecture \\
\hline
ReviewController & Avis et notes \\
\hline
SearchController & Recherche et autocomplétion \\
\hline
SecurityController & Login/Logout \\
\hline
RegistrationController & Inscription \\
\hline
\end{tabular}
\end{table}

\subsection{Services Métier}

\begin{table}[H]
\centering
\caption{Services Applicatifs}
\begin{tabular}{|l|p{8cm}|}
\hline
\textbf{Service} & \textbf{Fonction} \\
\hline
EmailService & Envoi d'emails (vérification, notifications, etc.) \\
\hline
StripePaymentService & Traitement des paiements Stripe \\
\hline
ActivityLogger & Journalisation des actions utilisateur \\
\hline
BookRecommendationService & Recommandations de livres \\
\hline
ReadingStreakService & Calcul des séries de lecture \\
\hline
GoalAchievementService & Suivi des objectifs de lecture \\
\hline
\end{tabular}
\end{table}

\section{Migrations de Base de Données}

\subsection{Liste des Migrations}

Le projet contient 25 migrations Doctrine, documentant l'évolution du schéma :

\begin{table}[H]
\centering
\caption{Migrations Principales}
\begin{tabular}{|l|p{8cm}|}
\hline
\textbf{Migration} & \textbf{Description} \\
\hline
Version20251020135839 & Schéma initial (User, Livre, etc.) \\
\hline
Version20251109091325 & Ajout du système de prêt (Loan) \\
\hline
Version20251116090619 & Ajout des réservations \\
\hline
Version20251117072736 & Système de panier et commandes \\
\hline
Version20251128154844 & Système de bannières \\
\hline
Version20251203003629 & Progression de lecture \\
\hline
Version20251205120542 & Ajout stockVente, stockEmprunt \\
\hline
Version20251205124757 & Migration des données de stock \\
\hline
\end{tabular}
\end{table}

\subsection{Migration du Stock Double}

\begin{lstlisting}[language=PHP, caption=Migration pour le Stock Double]
public function up(Schema $schema): void
{
    $this->addSql('ALTER TABLE livre ADD stock_vente INT 
        DEFAULT 0 NOT NULL');
    $this->addSql('ALTER TABLE livre ADD stock_emprunt INT 
        DEFAULT 0 NOT NULL');
    
    // Migration des donnees existantes
    $this->addSql('UPDATE livre SET 
        stock_vente = FLOOR(nb_exemplaires / 2),
        stock_emprunt = CEIL(nb_exemplaires / 2)
        WHERE nb_exemplaires > 0');
}
\end{lstlisting}

\section{Tests et Validation}

\subsection{Cas de Test - Système de Prêt}

\begin{table}[H]
\centering
\caption{Tests du Workflow de Prêt}
\begin{tabular}{|l|l|l|}
\hline
\textbf{Cas} & \textbf{Résultat Attendu} & \textbf{Statut} \\
\hline
Demande avec stock OK & Loan créé (requested) & \checkmark \\
Demande sans stock & Proposition réservation & \checkmark \\
Approbation admin & Status: approved, stock-- & \checkmark \\
Retour de livre & Status: returned, stock++ & \checkmark \\
Détection retard & Status: overdue & \checkmark \\
Annulation & Status: cancelled & \checkmark \\
\hline
\end{tabular}
\end{table}

\subsection{Cas de Test - E-Commerce}

\begin{table}[H]
\centering
\caption{Tests du Processus d'Achat}
\begin{tabular}{|l|l|l|}
\hline
\textbf{Cas} & \textbf{Résultat Attendu} & \textbf{Statut} \\
\hline
Ajout au panier (stock OK) & CartItem créé & \checkmark \\
Ajout au panier (stock 0) & Message d'erreur & \checkmark \\
Paiement Stripe valide & Order créé, stock-- & \checkmark \\
Paiement échoué & Panier conservé & \checkmark \\
Email confirmation & Email envoyé & \checkmark \\
\hline
\end{tabular}
\end{table}

\subsection{Cas de Test - Stock Double}

\begin{table}[H]
\centering
\caption{Tests du Système de Stock}
\begin{tabular}{|l|l|l|}
\hline
\textbf{Cas} & \textbf{Résultat Attendu} & \textbf{Statut} \\
\hline
Achat utilise stockVente & stockVente décrémenté & \checkmark \\
Emprunt utilise stockEmprunt & stockEmprunt décrémenté & \checkmark \\
Total calculé correctement & nbExemplaires = somme & \checkmark \\
Formulaire admin valide & Deux champs distincts & \checkmark \\
Affichage template & Format V:X | E:Y & \checkmark \\
\hline
\end{tabular}
\end{table}

\section{Interface Utilisateur}

\subsection{Design Responsive}

L'application utilise Bootstrap 4 pour un design entièrement responsive :

\begin{itemize}
    \item \textbf{Desktop} : Layout complet avec sidebar admin
    \item \textbf{Tablette} : Navigation adaptée, menu hamburger
    \item \textbf{Mobile} : Interface optimisée tactile
\end{itemize}

\subsection{Composants Clés}

\subsubsection{Barre de Navigation}
\begin{itemize}
    \item Logo et branding
    \item Menu de navigation responsive
    \item Barre de recherche globale
    \item Compteur de panier dynamique
    \item Badge messages non lus
    \item Menu utilisateur dropdown
\end{itemize}

\subsubsection{Catalogue de Livres}
\begin{itemize}
    \item Cartes avec images de couverture
    \item Affichage du prix et des stocks (V:X | E:Y)
    \item Boutons d'action (Acheter, Emprunter, Réserver)
    \item Badges de disponibilité
    \item Pagination intuitive
\end{itemize}

\subsubsection{Calendrier de Disponibilité}
\begin{itemize}
    \item Vue mensuelle FullCalendar
    \item Événements colorés par statut
    \item Dates de retour prévues
    \item Navigation mois précédent/suivant
\end{itemize}

\section{Sécurité}

\subsection{Authentification}
\begin{itemize}
    \item Hashage bcrypt/argon2 des mots de passe
    \item Tokens de vérification email sécurisés
    \item Tokens de réinitialisation avec expiration
    \item Protection contre la fixation de session
\end{itemize}

\subsection{Autorisation}
\begin{itemize}
    \item Contrôle d'accès RBAC (ROLE\_USER, ROLE\_ADMIN)
    \item Annotations IsGranted sur les contrôleurs
    \item Hiérarchie de rôles configurée
    \item Protection CSRF sur tous les formulaires
\end{itemize}

\subsection{Protection des Données}
\begin{itemize}
    \item Requêtes préparées (injection SQL)
    \item Échappement Twig automatique (XSS)
    \item Validation des uploads de fichiers
    \item Sanitation des entrées utilisateur
\end{itemize}

\section{Conclusion et Perspectives}

\subsection{Bilan du Projet}

Biblio représente une réalisation complète d'un système de gestion de bibliothèque moderne. Le projet démontre la maîtrise approfondie du framework Symfony et des technologies web contemporaines.

\subsection{Points Forts}

\begin{itemize}
    \item \textbf{Architecture Robuste} : Symfony 7, MVC strict, services métier
    \item \textbf{Modèle de Données Complet} : 18 entités avec relations complexes
    \item \textbf{Workflow de Prêt Complet} : Du demande au retour avec tous les cas
    \item \textbf{Stock Intelligent} : Séparation vente/emprunt innovante
    \item \textbf{Double Admin} : EasyAdmin + Dashboard personnalisé
    \item \textbf{E-Commerce Fonctionnel} : Panier, paiement Stripe, commandes
    \item \textbf{UX Moderne} : Responsive, calendrier interactif, temps réel
\end{itemize}

\subsection{Difficultés Rencontrées}

\begin{itemize}
    \item Configuration de l'intégration Stripe
    \item Gestion des relations ManyToMany complexes
    \item Compatibilité Turbo/Hotwire avec JavaScript tiers (FullCalendar)
    \item Migration des données existantes lors du changement de schéma
    \item Optimisation des requêtes Doctrine pour les listes paginées
\end{itemize}

\subsection{Compétences Acquises}

\begin{itemize}
    \item Développement web avancé avec Symfony 7
    \item Conception de bases de données relationnelles
    \item Intégration de services de paiement
    \item Gestion de workflows complexes (state machine)
    \item Création d'interfaces admin personnalisées
    \item Tests et validation de fonctionnalités
\end{itemize}

\subsection{Évolutions Possibles}

\begin{itemize}
    \item Application mobile avec API REST
    \item Système de recommandation par IA
    \item Notifications push temps réel
    \item Lecteur PDF intégré
    \item Statistiques avancées avec graphiques
    \item Support multilingue complet
    \item Pénalités automatiques pour retards
\end{itemize}

\vspace{1cm}

\textbf{Références :}
\begin{itemize}
    \item \href{https://github.com/ahmedKhlif/biblio_Symfony}{Dépôt GitHub - https://github.com/ahmedKhlif/biblio\_Symfony}
    \item Documentation Symfony 7
    \item Documentation Doctrine ORM
    \item Documentation EasyAdmin 4
    \item Documentation Stripe Payments
    \item Documentation Bootstrap 4
    \item Documentation FullCalendar.js
\end{itemize}

\end{document}
