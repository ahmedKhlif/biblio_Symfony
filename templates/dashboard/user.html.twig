{% extends 'backendofficebase.html.twig' %}
{% block title %}User Dashboard{% endblock %}

{% block body %}
<div class="container-fluid">

    <!-- ======================================== -->
    <!-- 1. WELCOME HEADER                        -->
    <!-- ======================================== -->
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <div>
            <h1 class="h3 mb-0 text-gray-800">
                <i class="fas fa-user-circle text-primary mr-2"></i>
                Welcome back, {{ user.username }}!
            </h1>
            <p class="text-muted mb-0">Member since {{ user.createdAt|date('M j, Y') }} • Here's your reading dashboard overview</p>
        </div>
        <div>
            <a href="{{ path('app_user_goals') }}" class="btn btn-outline-primary mr-2">
                <i class="fas fa-bullseye mr-1"></i>Set Goals
            </a>
            <a href="{{ path('app_logout') }}" class="btn btn-danger">
                <i class="fas fa-sign-out-alt mr-1"></i>Logout
            </a>
        </div>
    </div>

    <!-- ======================================== -->
    <!-- 2. KEY STATISTICS CARDS (LARGE)          -->
    <!-- ======================================== -->
    <div class="row mb-4">
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-primary shadow h-100 py-3">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">My Library</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ myBooksCount }}</div>
                            <div class="text-xs text-muted">Books owned</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-book fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-success shadow h-100 py-3">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">Reading Progress</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ overallProgress|round(0) }}%</div>
                            <div class="text-xs text-muted">Overall completion</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-chart-line fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-info shadow h-100 py-3">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">Shopping Cart</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="cart-count">{{ cartItemsCount ?: 0 }}</div>
                            <div class="text-xs text-muted">Items in cart</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-shopping-cart fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-warning shadow h-100 py-3">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">Active Loans</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ activeLoansCount ?: 0 }}</div>
                            <div class="text-xs text-muted">Books borrowed</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-book-reader fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ======================================== -->
    <!-- 2.25. READING STREAK COMPONENT          -->
    <!-- ======================================== -->
    <div class="row mb-4">
        <div class="col-12">
            {% include 'components/_reading_streak.html.twig' with {
                'streakStats': streakStats,
                'achievements': achievements,
                'motivationalMessage': motivationalMessage
            } %}
        </div>
    </div>

    <!-- ======================================== -->
    <!-- 2.5. RECENT ORDERS & NOTIFICATIONS      -->
    <!-- ======================================== -->
    <div class="row mb-4">
        <div class="col-lg-6 mb-4">
            <div class="card shadow h-100">
                <div class="card-header py-3 bg-gradient-primary">
                    <h6 class="m-0 font-weight-bold text-white">
                        <i class="fas fa-shopping-bag mr-2"></i>Recent Orders
                    </h6>
                </div>
                <div class="card-body">
                    {% set recentOrders = user.orders|slice(0, 3) %}
                    {% if recentOrders|length > 0 %}
                        {% for order in recentOrders %}
                            <div class="d-flex align-items-center mb-3 p-2 border rounded">
                                <div class="flex-shrink-0 mr-3">
                                    <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center"
                                         style="width: 40px; height: 40px;">
                                        <i class="fas fa-receipt"></i>
                                    </div>
                                </div>
                                <div class="flex-grow-1">
                                    <div class="font-weight-bold text-dark">Order #{{ order.orderNumber }}</div>
                                    <small class="text-muted">{{ order.createdAt|date('M j, Y') }} • {{ order.totalAmountFloat|number_format(2, ',', ' ') }} €</small>
                                    {% if order.paymentMethod %}
                                        <div class="text-xs text-info mt-1">
                                            <i class="fas fa-credit-card mr-1"></i>
                                            Paid with: <strong>{{ order.paymentMethodLabel }}</strong>
                                        </div>
                                    {% endif %}
                                    <div class="mt-1">
                                        {% set statusClass = {
                                            'pending': 'warning',
                                            'paid': 'info',
                                            'processing': 'secondary',
                                            'shipped': 'primary',
                                            'delivered': 'success',
                                            'cancelled': 'danger',
                                            'refunded': 'dark'
                                        }[order.status] ?? 'secondary' %}
                                        <span class="badge badge-{{ statusClass }} badge-sm">{{ order.statusLabel }}</span>
                                    </div>
                                </div>
                                <div class="flex-shrink-0">
                                    <a href="{{ path('app_profile_orders') }}" class="btn btn-outline-primary btn-sm">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                </div>
                            </div>
                        {% endfor %}
                        <div class="text-center">
                            <a href="{{ path('app_profile_orders') }}" class="btn btn-primary btn-sm">
                                <i class="fas fa-list mr-1"></i>View All Orders
                            </a>
                        </div>
                    {% else %}
                        <div class="text-center py-4">
                            <i class="fas fa-shopping-bag fa-2x text-gray-300 mb-2"></i>
                            <p class="text-muted mb-0">No orders yet</p>
                            <a href="{{ path('app_livre_index') }}" class="btn btn-primary btn-sm mt-2">
                                <i class="fas fa-shopping-cart mr-1"></i>Start Shopping
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="col-lg-6 mb-4">
            <div class="card shadow h-100">
                <div class="card-header py-3 bg-gradient-info">
                    <h6 class="m-0 font-weight-bold text-white">
                        <i class="fas fa-bell mr-2"></i>Notifications
                    </h6>
                </div>
                <div class="card-body">
                    {% set notifications = [] %}
                    {% for loan in user.loans %}
                        {% if loan.status == 'overdue' %}
                            {% set notifications = notifications|merge([{
                                'type': 'danger',
                                'icon': 'fas fa-exclamation-triangle',
                                'title': 'Loan Overdue',
                                'message': 'Return "' ~ loan.livre.titre ~ '" immediately',
                                'link': path('app_loan_index')
                            }]) %}
                        {% elseif loan.status == 'approved' %}
                            {% set notifications = notifications|merge([{
                                'type': 'success',
                                'icon': 'fas fa-check-circle',
                                'title': 'Loan Approved',
                                'message': 'You can pick up "' ~ loan.livre.titre ~ '"',
                                'link': path('app_loan_index')
                            }]) %}
                        {% endif %}
                    {% endfor %}

                    {% for order in user.orders|slice(0, 2) %}
                        {% if order.status == 'shipped' %}
                            {% set notifications = notifications|merge([{
                                'type': 'info',
                                'icon': 'fas fa-truck',
                                'title': 'Order Shipped',
                                'message': 'Order #' ~ order.orderNumber ~ ' is on its way',
                                'link': path('app_profile_orders')
                            }]) %}
                        {% elseif order.status == 'delivered' %}
                            {% set notifications = notifications|merge([{
                                'type': 'success',
                                'icon': 'fas fa-box-open',
                                'title': 'Order Delivered',
                                'message': 'Order #' ~ order.orderNumber ~ ' has been delivered',
                                'link': path('app_profile_orders')
                            }]) %}
                        {% endif %}
                    {% endfor %}

                    {% if notifications|length > 0 %}
                        {% for notification in notifications|slice(0, 4) %}
                            <div class="d-flex align-items-start mb-3 p-2 border-left-{{ notification.type }} rounded">
                                <div class="flex-shrink-0 mr-3">
                                    <i class="fas {{ notification.icon }} text-{{ notification.type }}"></i>
                                </div>
                                <div class="flex-grow-1">
                                    <div class="font-weight-bold text-{{ notification.type }}">{{ notification.title }}</div>
                                    <small class="text-muted">{{ notification.message }}</small>
                                </div>
                                <div class="flex-shrink-0">
                                    <a href="{{ notification.link }}" class="btn btn-outline-{{ notification.type }} btn-sm">
                                        <i class="fas fa-arrow-right"></i>
                                    </a>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <div class="text-center py-4">
                            <i class="fas fa-bell-slash fa-2x text-gray-300 mb-2"></i>
                            <p class="text-muted mb-0">No new notifications</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- ======================================== -->
    <!-- 3. CONTINUE READING (FULL WIDTH)         -->
    <!-- ======================================== -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow h-100">
                <div class="card-header py-3 bg-gradient-primary">
                    <h6 class="m-0 font-weight-bold text-white">
                        <i class="fas fa-play-circle mr-2"></i>Continue Reading
                    </h6>
                </div>
                <div class="card-body">
                    {% set inProgressBooks = userReadingProgress|filter(progress => not progress.isCompleted) %}
                    {% if inProgressBooks|length > 0 %}
                        <div class="row">
                            {% for progress in inProgressBooks|slice(0, 4) %}
                                <div class="col-lg-3 col-md-6 mb-4">
                                    <div class="card h-100 border-left-info">
                                        <div class="card-body">
                                            {% if progress.livre.image %}
                                                <img src="{{ asset('uploads/images/' ~ progress.livre.image) }}"
                                                     alt="{{ progress.livre.titre }}"
                                                     class="img-fluid rounded mb-2"
                                                     style="height: 150px; width: 100%; object-fit: cover;">
                                            {% else %}
                                                <div class="text-center mb-2 bg-light rounded d-flex align-items-center justify-content-center"
                                                     style="height: 150px;">
                                                    <i class="fas fa-book fa-3x text-gray-300"></i>
                                                </div>
                                            {% endif %}

                                            <h6 class="card-title font-weight-bold mb-1">
                                                {{ progress.livre.titre|slice(0, 25) ~ (progress.livre.titre|length > 25 ? '...' : '') }}
                                            </h6>
                                            <p class="card-text small text-muted mb-2">
                                                {{ progress.livre.auteur ? progress.livre.auteur.prenom ~ ' ' ~ progress.livre.auteur.nom : 'Auteur inconnu' }}
                                            </p>
                                            <div class="mb-2">
                                                <small class="text-muted d-block">Progress</small>
                                                <div class="progress" style="height: 8px;">
                                                    <div class="progress-bar bg-info"
                                                         role="progressbar"
                                                         style="width: {{ progress.progressPercentage }}%">
                                                    </div>
                                                </div>
                                                <small class="text-muted">{{ progress.progressPercentage }}% complete</small>
                                            </div>
                                            <a href="{{ path('app_livre_show', {'id': progress.livre.id}) }}"
                                               class="btn btn-primary btn-sm btn-block">
                                                <i class="fas fa-play mr-1"></i>Continue Reading
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="text-center py-5">
                            <i class="fas fa-book-open fa-3x text-gray-300 mb-3"></i>
                            <h5 class="text-muted">No books in progress</h5>
                            <p class="text-muted">Start reading a book to see it here!</p>
                            <a href="{{ path('app_livre_index') }}" class="btn btn-primary">
                                <i class="fas fa-search mr-1"></i>Browse Books
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- ======================================== -->
    <!-- 4. LEFT: Goals + Quick Actions           -->
    <!-- ======================================== -->
    <div class="row mb-4">
        <div class="col-lg-4">

            <!-- Reading Goals -->
            <div class="card shadow mb-4">
                <div class="card-header py-3 bg-gradient-success">
                    <h6 class="m-0 font-weight-bold text-white">
                        <i class="fas fa-bullseye mr-2"></i>Reading Goals
                    </h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <div class="d-flex justify-content-between align-items-center mb-1">
                            <span class="text-xs font-weight-bold text-uppercase">Books This Year</span>
                            {% if booksThisYearGoal %}
                                <span class="badge badge-success">
                                    {{ booksThisYearGoal.currentValue }}/{{ booksThisYearGoal.targetValue }}
                                </span>
                            {% endif %}
                        </div>
                        {% if booksThisYearGoal %}
                            <div class="progress mb-2" style="height: 10px;">
                                <div class="progress-bar bg-success" style="width: {{ booksThisYearGoal.progressPercentage }}%"></div>
                            </div>
                            <small class="text-muted">{{ booksThisYearGoal.progressPercentage|round(1) }}% complete</small>
                        {% else %}
                            <small class="text-muted">No goal set</small>
                        {% endif %}
                    </div>
                    <hr>
                    <div class="mb-0">
                        <div class="d-flex justify-content-between align-items-center mb-1">
                            <span class="text-xs font-weight-bold text-uppercase">Pages This Month</span>
                            {% if pagesThisMonthGoal %}
                                <span class="badge badge-info">
                                    {{ pagesThisMonthGoal.currentValue }}/{{ pagesThisMonthGoal.targetValue }}
                                </span>
                            {% endif %}
                        </div>
                        {% if pagesThisMonthGoal %}
                            <div class="progress mb-2" style="height: 10px;">
                                <div class="progress-bar bg-info" style="width: {{ pagesThisMonthGoal.progressPercentage }}%"></div>
                            </div>
                            <small class="text-muted">{{ pagesThisMonthGoal.progressPercentage|round(1) }}% complete</small>
                        {% else %}
                            <small class="text-muted">No goal set</small>
                        {% endif %}
                    </div>
                    <div class="text-center mt-3">
                        <a href="{{ path('app_user_goals') }}" class="btn btn-success btn-sm">
                            <i class="fas fa-edit mr-1"></i>Manage Goals
                        </a>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="card shadow">
                <div class="card-header py-3 bg-gradient-warning">
                    <h6 class="m-0 font-weight-bold text-white">
                        <i class="fas fa-bolt mr-2"></i>Quick Actions
                    </h6>
                </div>
                <div class="card-body">
                    <a href="{{ path('app_livre_index') }}" class="btn btn-primary btn-block mb-2">
                        <i class="fas fa-search mr-2"></i>Browse Books
                    </a>
                    <a href="{{ path('app_user_wishlist') }}" class="btn btn-success btn-block mb-2">
                        <i class="fas fa-heart mr-2"></i>My Wishlist
                    </a>
                    <a href="{{ path('app_user_reading_history') }}" class="btn btn-info btn-block mb-2">
                        <i class="fas fa-history mr-2"></i>Reading History
                    </a>
                    <a href="{{ path('app_user_owned_books') }}" class="btn btn-secondary btn-block mb-2">
                        <i class="fas fa-book mr-2"></i>My Library
                    </a>
                    <a href="{{ path('app_user_favorites') }}" class="btn btn-danger btn-block mb-2">
                        <i class="fas fa-star mr-2"></i>Favorite Authors
                    </a>
                    <hr>
                    <a href="{{ path('app_user_goals') }}" class="btn btn-warning btn-block">
                        <i class="fas fa-bullseye mr-2"></i>Set Goals
                    </a>
                </div>
            </div>
        </div>

        <!-- ======================================== -->
        <!-- 5. RIGHT: Reading Progress Table         -->
        <!-- ======================================== -->
        <div class="col-lg-8">
            <div class="card shadow h-100">
                <div class="card-header py-3 bg-gradient-info">
                    <h6 class="m-0 font-weight-bold text-white">
                        <i class="fas fa-chart-bar mr-2"></i>Reading Progress
                    </h6>
                </div>
                <div class="card-body">
                    {% if userReadingProgress|length > 0 %}
                        <div class="table-responsive">
                            <table class="table table-hover align-middle">
                                <thead class="thead-light">
                                    <tr>
                                        <th>Book</th>
                                        <th>Author</th>
                                        <th>Current Page</th>
                                        <th>Progress</th>
                                        <th>Last Read</th>
                                        <th class="text-center">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for progress in userReadingProgress %}
                                        <tr>
                                            <td>
                                                <div class="d-flex align-items-center">
                                                    {% if progress.livre.image %}
                                                        <img src="{{ asset('uploads/images/' ~ progress.livre.image) }}"
                                                             alt="{{ progress.livre.titre }}"
                                                             class="rounded mr-2"
                                                             style="width: 40px; height: 50px; object-fit: cover;">
                                                    {% else %}
                                                        <div class="bg-light rounded mr-2 d-flex align-items-center justify-content-center"
                                                             style="width: 40px; height: 50px;">
                                                            <i class="fas fa-book text-muted"></i>
                                                        </div>
                                                    {% endif %}
                                                    <div>
                                                        <div class="font-weight-bold">{{ progress.livre.titre }}</div>
                                                        <small class="text-muted">
                                                            {{ progress.livre.categorie ? progress.livre.categorie.designation : 'N/A' }}
                                                        </small>
                                                    </div>
                                                </div>
                                            </td>
                                            <td class="text-truncate" style="max-width: 150px;">
                                                {{ progress.livre.auteur ? progress.livre.auteur.prenom ~ ' ' ~ progress.livre.auteur.nom : 'Auteur inconnu' }}
                                            </td>
                                            <td>
                                                <form method="post" action="{{ path('app_user_update_progress', {'id': progress.livre.id}) }}" class="d-inline">
                                                    <input type="hidden" name="_token" value="{{ csrf_token('update_progress_' ~ progress.livre.id) }}">
                                                    <div class="input-group input-group-sm" style="width: 120px;">
                                                        <input type="number" name="current_page" class="form-control form-control-sm"
                                                               value="{{ progress.currentPage ?: '' }}"
                                                               placeholder="Page"
                                                               min="1" max="{{ progress.livre.nbPages ?: 9999 }}">
                                                        <div class="input-group-append">
                                                            <button type="submit" class="btn btn-outline-primary btn-sm">
                                                                <i class="fas fa-save"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </form>
                                            </td>
                                            <td>
                                                <div class="d-flex align-items-center">
                                                    <div class="progress flex-grow-1 mr-2" style="height: 8px;">
                                                        <div class="progress-bar {% if progress.isCompleted %}bg-success{% else %}bg-info{% endif %}"
                                                             style="width: {{ progress.progressPercentage }}%">
                                                        </div>
                                                    </div>
                                                    <small class="text-muted">{{ progress.progressPercentage }}%</small>
                                                </div>
                                            </td>
                                            <td><small class="text-muted">{{ progress.lastReadAt|date('M j') }}</small></td>
                                            <td class="text-center">
                                                {% if progress.isCompleted %}
                                                    <a href="{{ path('app_user_review_create', {'id': progress.livre.id}) }}"
                                                       class="btn btn-success btn-sm">
                                                        <i class="fas fa-star"></i>
                                                    </a>
                                                {% else %}
                                                    <a href="{{ path('app_livre_show', {'id': progress.livre.id}) }}"
                                                       class="btn btn-primary btn-sm">
                                                        <i class="fas fa-play"></i>
                                                    </a>
                                                {% endif %}
                                            </td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <div class="text-center py-5">
                            <i class="fas fa-book-open fa-3x text-gray-300 mb-3"></i>
                            <h5 class="text-muted">No reading progress yet</h5>
                            <p class="text-muted">Start reading books to track your progress here!</p>
                            <a href="{{ path('app_livre_index') }}" class="btn btn-primary">
                                <i class="fas fa-search mr-1"></i>Find Books
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- ======================================== -->
    <!-- 6. NEW RELEASES (WIDER)                  -->
    <!-- ======================================== -->
    <div class="row mb-4">
        <div class="col-lg-8">
            <div class="card shadow">
                <div class="card-header py-3 bg-gradient-primary">
                    <h6 class="m-0 font-weight-bold text-white">
                        <i class="fas fa-star mr-2"></i>New Releases
                    </h6>
                </div>
                <div class="card-body p-3">
                    <div class="scroll-container">
                        {% for livre in derniersLivres %}
                            <div class="card shadow-sm border-left-primary hover-card"
                                 style="min-width: 250px; max-width: 250px;">
                                <div class="card-header bg-gradient-primary text-white text-center py-2">
                                    <h6 class="font-weight-bold mb-0 small">
                                        {{ livre.titre|slice(0, 25) ~ (livre.titre|length > 25 ? '...' : '') }}
                                    </h6>
                                </div>
                                <div class="card-body p-3">
                                    {% if livre.image %}
                                        <img src="{{ asset('uploads/images/' ~ livre.image) }}"
                                             alt="{{ livre.titre }}"
                                             class="img-fluid rounded mb-2"
                                             style="height: 120px; width: 100%; object-fit: cover;">
                                    {% else %}
                                        <div class="text-center mb-2 bg-light rounded d-flex align-items-center justify-content-center"
                                             style="height: 120px;">
                                            <i class="fas fa-book fa-2x text-gray-300"></i>
                                        </div>
                                    {% endif %}
                                    <div class="mb-2">
                                        <small class="text-muted d-block">
                                            <i class="fas fa-user text-primary mr-1"></i>
                                            <strong>{{ livre.auteur ? livre.auteur.prenom ~ ' ' ~ livre.auteur.nom : 'Auteur inconnu' }}</strong>
                                        </small>
                                        <small class="text-muted d-block">
                                            <i class="fas fa-tag text-info mr-1"></i>
                                            {{ livre.categorie ? livre.categorie.designation : 'N/A' }}
                                        </small>
                                    </div>
                                    <div class="row text-center mb-2">
                                        <div class="col-6">
                                            <small class="text-muted d-block">Price</small>
                                            <span class="font-weight-bold text-success">{{ livre.prix }} €</span>
                                        </div>
                                        <div class="col-6">
                                            <small class="text-muted d-block">Stock Vente</small>
                                            {% if livre.stockVente > 0 %}
                                                <span class="badge badge-success">{{ livre.stockVente }}</span>
                                            {% else %}
                                                <span class="badge badge-danger">Épuisé</span>
                                            {% endif %}
                                        </div>
                                    </div>
                                    <a href="{{ path('app_livre_show', {'id': livre.id}) }}"
                                       class="btn btn-primary btn-sm btn-block">
                                        <i class="fas fa-eye mr-1"></i>View Details
                                    </a>
                                </div>
                                <div class="card-footer text-center py-2 bg-light">
                                    <small class="text-muted">
                                        <i class="fas fa-calendar mr-1"></i>{{ livre.dateEdition|date('M Y') }}
                                    </small>
                                </div>
                            </div>
                        {% else %}
                            <div class="col-12 text-center py-5">
                                <i class="fas fa-book fa-3x text-gray-300 mb-3"></i>
                                <h5 class="text-muted">No books found</h5>
                                <p class="text-muted">New releases will appear here.</p>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <!-- ======================================== -->
        <!-- 7. CATEGORIES + STATS (RIGHT)            -->
        <!-- ======================================== -->
        <div class="col-lg-4">
            <!-- Categories -->
            <div class="card shadow mb-4">
                <div class="card-header py-3 bg-gradient-info">
                    <h6 class="m-0 font-weight-bold text-white">
                        <i class="fas fa-tags mr-2"></i>Browse Categories
                    </h6>
                </div>
                <div class="card-body">
                    {% for categorie in categories|slice(0, 6) %}
                        <a href="{{ path('app_categorie_show', {'id': categorie.id}) }}"
                           class="d-flex align-items-center p-2 mb-2 text-decoration-none border rounded hover-category">
                            <div class="text-info mr-3">
                                <i class="fas fa-tag fa-lg"></i>
                            </div>
                            <div class="flex-grow-1">
                                <div class="font-weight-bold text-dark">{{ categorie.designation }}</div>
                                <small class="text-muted">{{ categorie.description|slice(0, 40) ~ '...' }}</small>
                            </div>
                            <div class="text-muted">
                                <i class="fas fa-chevron-right"></i>
                            </div>
                        </a>
                    {% endfor %}
                    <div class="text-center mt-3">
                        <a href="{{ path('app_categorie_index') }}" class="btn btn-info btn-sm">
                            <i class="fas fa-list mr-1"></i>View All Categories
                        </a>
                    </div>
                </div>
            </div>

            <!-- Reading Stats -->
            <div class="card shadow">
                <div class="card-header py-3 bg-gradient-success">
                    <h6 class="m-0 font-weight-bold text-white">
                        <i class="fas fa-chart-pie mr-2"></i>Reading Stats
                    </h6>
                </div>
                <div class="card-body">
                    <div class="row text-center g-3">
                        <div class="col-6">
                            <i class="fas fa-book-open fa-2x text-success mb-2"></i>
                            <h4 class="text-success">{{ userReadingProgress|length }}</h4>
                            <small class="text-muted">Books Started</small>
                        </div>
                        <div class="col-6">
                            <i class="fas fa-check-circle fa-2x text-info mb-2"></i>
                            <h4 class="text-info">{{ userCompletedBooks|length }}</h4>
                            <small class="text-muted">Books Completed</small>
                        </div>
                    </div>
                    <hr>
                    <p class="text-center text-muted small mb-0">Keep reading to improve your stats!</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ======================================== -->
    <!-- 8. FEATURED PUBLISHERS (FULL WIDTH)      -->
    <!-- ======================================== -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow">
                <div class="card-header py-3 bg-gradient-warning">
                    <h6 class="m-0 font-weight-bold text-white">
                        <i class="fas fa-building mr-2"></i>Featured Publishers
                    </h6>
                </div>
                <div class="card-body p-3">
                    <div class="scroll-container">
                        {% for editeur in editeurs %}
                            <div class="card shadow-sm border-left-warning hover-card"
                                 style="min-width: 280px; max-width: 280px;">
                                <div class="card-body p-3">
                                    <div class="d-flex align-items-center mb-2">
                                        <div class="text-warning mr-3">
                                            <i class="fas fa-building fa-2x"></i>
                                        </div>
                                        <div class="flex-grow-1">
                                            <h6 class="font-weight-bold mb-0">{{ editeur.nomEditeur }}</h6>
                                            <small class="text-muted">
                                                <i class="fas fa-map-marker-alt mr-1"></i>{{ editeur.pays }}
                                            </small>
                                        </div>
                                    </div>
                                    <hr class="my-2">
                                    <div class="row text-center small">
                                        <div class="col-6">
                                            <small class="text-muted d-block">Contact</small>
                                            <span class="font-weight-bold">{{ editeur.telephone }}</span>
                                        </div>
                                        <div class="col-6">
                                            <small class="text-muted d-block">Location</small>
                                            <span class="font-weight-bold">{{ editeur.adresse|slice(0, 12) ~ '...' }}</span>
                                        </div>
                                    </div>
                                    <div class="text-center mt-3">
                                        <a href="{{ path('app_editeur_show', {'id': editeur.id}) }}"
                                           class="btn btn-warning btn-sm">
                                            <i class="fas fa-eye mr-1"></i>View Publisher
                                        </a>
                                    </div>
                                </div>
                            </div>
                        {% else %}
                            <div class="col-12 text-center py-4">
                                <i class="fas fa-building fa-3x text-gray-300 mb-3"></i>
                                <p class="text-muted">No publishers found</p>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ======================================== -->
    <!-- 9. CUSTOM STYLES (UNCHANGED)             -->
    <!-- ======================================== -->
    <style>
        .hover-card { transition: all 0.3s ease; cursor: pointer; }
        .hover-card:hover { transform: translateY(-8px); box-shadow: 0 1rem 2rem rgba(0,0,0,0.2) !important; }
        .hover-category { transition: all 0.2s ease; border: 1px solid #e3e6f0 !important; }
        .hover-category:hover { background-color: #f8f9fc !important; border-color: #bac8f3 !important; transform: translateX(5px); }

        .bg-gradient-primary { background: linear-gradient(135deg, #4e73df 0%, #224abe 100%); }
        .bg-gradient-success { background: linear-gradient(135deg, #1cc88a 0%, #13855c 100%); }
        .bg-gradient-info { background: linear-gradient(135deg, #36b9cc 0%, #2c9faf 100%); }
        .bg-gradient-warning { background: linear-gradient(135deg, #f6c23e 0%, #dda20a 100%); }

        .scroll-container {
            display: flex; overflow-x: auto; gap: 1rem; padding-bottom: .5rem;
            scrollbar-width: thin; scrollbar-color: #bac8f3 #f8f9fc;
        }
        .scroll-container::-webkit-scrollbar { height: 8px; }
        .scroll-container::-webkit-scrollbar-track { background: #f8f9fc; border-radius: 4px; }
        .scroll-container::-webkit-scrollbar-thumb { background: #bac8f3; border-radius: 4px; }
        .scroll-container .card { flex-shrink: 0; }

        .progress, .progress-bar { border-radius: 10px; }
        .card { border: none; border-radius: 15px; box-shadow: 0 0.125rem 0.25rem rgba(0,0,0,0.075); }
        .card-header { border-radius: 15px 15px 0 0 !important; border: none; }

        .btn { border-radius: 25px; font-weight: 600; transition: all 0.3s ease; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 .5rem 1rem rgba(0,0,0,.15); }

        .table-hover tbody tr:hover { background-color: rgba(0,0,0,0.03); }
        .badge { border-radius: 20px; font-weight: 600; }

        @media (max-width: 768px) {
            .scroll-container { gap: 0.75rem; }
            .scroll-container .card { min-width: 220px !important; max-width: 220px !important; }
            .btn-block { margin-bottom: 0.5rem; }
        }
        @media (max-width: 576px) {
            .scroll-container .card { min-width: 200px !important; max-width: 200px !important; }
            .h3 { font-size: 1.5rem; }
        }

        @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        .card { animation: fadeInUp 0.6s ease-out; }
        .shadow { box-shadow: 0 0.5rem 1rem rgba(0,0,0,0.08) !important; }
    </style>

</div>
{% endblock %}