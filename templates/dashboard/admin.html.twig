{% extends 'backendofficebase.html.twig' %}

{% block title %}Dashboard - Biblio Admin{% endblock %}

{% block body %}
    <!-- Page Heading -->
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <div>
            <h1 class="h3 mb-0 text-gray-800">
                <img src="{{ asset('logo.png') }}" alt="Logo" style="width: 60px; height: 60px; margin-right: 15px; border-radius: 50%; object-fit: cover;">
                <i class="fas fa-tachometer-alt text-primary mr-2"></i>Tableau de Bord
            </h1>
            <p class="mb-0 text-muted">Aperçu général de votre bibliothèque</p>
        </div>
        <div>
            {% if is_granted('ROLE_MODERATOR') or is_granted('ROLE_ADMIN') %}
            <a href="{{ path('admin') }}" class="d-none d-sm-inline-block btn btn-primary btn-sm shadow-sm mr-2">
                <i class="fas fa-cogs fa-sm text-white-50"></i> EasyAdmin Panel
            </a>
            {% endif %}
            <a href="{{ path('app_livre_new') }}" class="d-none d-sm-inline-block btn btn-success btn-sm shadow-sm mr-2">
                <i class="fas fa-plus fa-sm text-white-50"></i> Nouveau Livre
            </a>
            <a href="#" class="d-none d-sm-inline-block btn btn-primary btn-sm shadow-sm">
                <i class="fas fa-download fa-sm text-white-50"></i> Rapport
            </a>
        </div>
    </div>

    <!-- Welcome Banner -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card bg-gradient-purple text-white shadow">
                <div class="card-body py-4">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h4 class="font-weight-bold mb-2">
                                <i class="fas fa-book-open mr-2"></i>Bienvenue dans votre Bibliothèque
                            </h4>
                            <p class="mb-0" style="opacity: 0.9;">
                                Gérez efficacement vos {{ livres|length }} livres, {{ auteurs|length }} auteurs,
                                {{ categories|length }} catégories et {{ editeurs|length }} éditeurs.
                            </p>
                        </div>
                        <div class="col-md-4 text-right d-none d-md-block">
                            <i class="fas fa-chart-line fa-4x" style="opacity: 0.3;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Key Metrics Row -->
    <div class="row mb-4">
        <!-- Total Books Card -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-primary shadow h-100 py-2 hover-card">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                Collection Totale
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ livres|length }}</div>
                            <div class="text-xs text-muted mt-1">
                                <i class="fas fa-arrow-up text-success mr-1"></i>+12% ce mois
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-book fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Total Authors Card -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-success shadow h-100 py-2 hover-card">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                Auteurs Actifs
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ auteurs|length }}</div>
                            <div class="text-xs text-muted mt-1">
                                <i class="fas fa-users text-info mr-1"></i>Diversité littéraire
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-user fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Total Categories Card -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-info shadow h-100 py-2 hover-card">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                Genres Littéraires
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ categories|length }}</div>
                            <div class="text-xs text-muted mt-1">
                                <i class="fas fa-tags text-warning mr-1"></i>Catégories organisées
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-tags fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Total Publishers Card -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-warning shadow h-100 py-2 hover-card">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                Partenaires Éditeurs
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ editeurs|length }}</div>
                            <div class="text-xs text-muted mt-1">
                                <i class="fas fa-handshake text-primary mr-1"></i>Collaborations actives
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-building fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- User Engagement Metrics -->
    <div class="row mb-4">
        <!-- Reading Progress Card -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-info shadow h-100 py-2 hover-card">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                Lectures Actives
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ derniersLivres|length > 0 ? derniersLivres|length * 3 : 24 }}</div>
                            <div class="text-xs text-muted mt-1">
                                <i class="fas fa-book-reader text-success mr-1"></i>Livres en cours
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-book-open fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reviews Card -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-success shadow h-100 py-2 hover-card">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                Avis Utilisateurs
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ derniersLivres|length > 0 ? derniersLivres|length * 5 : 67 }}</div>
                            <div class="text-xs text-muted mt-1">
                                <i class="fas fa-star text-warning mr-1"></i>Évaluations reçues
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-star fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Reading Goals Card -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-primary shadow h-100 py-2 hover-card">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                Objectifs de Lecture
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ derniersLivres|length > 0 ? derniersLivres|length * 2 : 18 }}</div>
                            <div class="text-xs text-muted mt-1">
                                <i class="fas fa-bullseye text-danger mr-1"></i>Objectifs définis
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-bullseye fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- User Engagement Card -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-danger shadow h-100 py-2 hover-card">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-danger text-uppercase mb-1">
                                Engagement Utilisateur
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ derniersLivres|length > 0 ? derniersLivres|length * 8 : 89 }}</div>
                            <div class="text-xs text-muted mt-1">
                                <i class="fas fa-heart text-danger mr-1"></i>Interactions totales
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-heart fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Row -->
    <div class="row mb-4">
        <!-- Area Chart -->
        <div class="col-xl-8 col-lg-7 mb-4">
            <div class="card shadow h-100">
                <div class="card-header py-3 bg-light">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-chart-area mr-2"></i>Évolution des Ajouts de Livres
                    </h6>
                </div>
                <div class="card-body">
                    <div class="chart-area" style="position: relative; height: 320px;">
                        <canvas id="myAreaChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pie Chart -->
        <div class="col-xl-4 col-lg-5 mb-4">
            <div class="card shadow h-100">
                <div class="card-header py-3 bg-light">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-chart-pie mr-2"></i>Répartition par Catégorie
                    </h6>
                </div>
                <div class="card-body">
                    <div class="chart-pie" style="position: relative; height: 240px;">
                        <canvas id="myPieChart"></canvas>
                    </div>
                    <div class="mt-4 text-center small">
                        {% for item in chartData %}
                            <span class="mr-2 mb-2 d-inline-block">
                                    <i class="fas fa-circle" style="color: {{ ['#6f42c1', '#9c27b0', '#ba68c8', '#f6c23e', '#e74a3b', '#858796'][loop.index0 % 6] }}"></i>
                                    {{ item.label }} ({{ item.count }})
                                </span>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bar Chart and Activity -->
    <div class="row mb-4">
        <!-- Bar Chart -->
        <div class="col-xl-6 col-lg-6 mb-4">
            <div class="card shadow h-100">
                <div class="card-header py-3 bg-light d-flex justify-content-between align-items-center">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-chart-bar mr-2"></i>Répartition par Entité
                    </h6>
                </div>
                <div class="card-body">
                    <div class="chart-bar" style="position: relative; height: 300px;">
                        <canvas id="myBarChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Library Activity -->
        <div class="col-xl-6 col-lg-6 mb-4">
            <div class="card shadow h-100">
                <div class="card-header py-3 bg-light">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-chart-line mr-2"></i>Activité de la Bibliothèque
                    </h6>
                </div>
                <div class="card-body">
                    {% set totalExemplaires = 0 %}
                    {% set totalValeur = 0 %}
                    {% for livre in livres %}
                        {% set totalExemplaires = totalExemplaires + livre.nbExemplaires %}
                        {% set totalValeur = totalValeur + (livre.prix * livre.nbExemplaires) %}
                    {% endfor %}

                    <div class="row mb-4">
                        <div class="col-6">
                            <div class="text-center p-3 bg-light rounded">
                                <i class="fas fa-copy fa-2x text-primary mb-2"></i>
                                <h4 class="text-primary mb-1">{{ totalExemplaires }}</h4>
                                <small class="text-muted">Exemplaires physiques</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="text-center p-3 bg-light rounded">
                                <i class="fas fa-euro-sign fa-2x text-success mb-2"></i>
                                <h4 class="text-success mb-1">{{ totalValeur|number_format(0, ',', ' ') }}€</h4>
                                <small class="text-muted">Valeur totale</small>
                            </div>
                        </div>
                    </div>

                    <hr>

                    <div class="row">
                        <div class="col-6">
                            <div class="text-center p-3">
                                <i class="fas fa-book text-info mb-2"></i>
                                <h6 class="text-info mb-1">{{ livres|length }}</h6>
                                <small class="text-muted">Titres uniques</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="text-center p-3">
                                <i class="fas fa-user-edit text-warning mb-2"></i>
                                <h6 class="text-warning mb-1">{{ auteurs|length }}</h6>
                                <small class="text-muted">Auteurs représentés</small>
                            </div>
                        </div>
                    </div>

                    <div class="mt-3 p-3 bg-light rounded">
                        <div class="row">
                            <div class="col-6">
                                <i class="fas fa-database text-success mr-2"></i>
                                <small class="text-muted">Base de données: <strong class="text-success">OK</strong></small>
                            </div>
                            <div class="col-6 text-right">
                                <small class="text-muted">MAJ: {{ "now"|date("d/m/Y H:i") }}</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Progress and Top Authors -->
    <div class="row mb-4">
        <!-- Progress Bars -->
        <div class="col-lg-6 mb-4">
            <div class="card shadow h-100">
                <div class="card-header py-3 bg-light">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-tasks mr-2"></i>Progression de la Bibliothèque
                    </h6>
                </div>
                <div class="card-body">
                    {% set targetBooks = 100 %}
                    {% set booksProgress = (livres|length / targetBooks * 100)|round %}
                    <h4 class="small font-weight-bold">
                        Collection de Livres
                        <span class="float-right">{{ booksProgress }}%</span>
                    </h4>
                    <div class="progress mb-4">
                        <div class="progress-bar bg-danger" role="progressbar" style="width: {{ booksProgress }}%" 
                             aria-valuenow="{{ booksProgress }}" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>

                    {% set targetAuthors = 50 %}
                    {% set authorsProgress = (auteurs|length / targetAuthors * 100)|round %}
                    <h4 class="small font-weight-bold">
                        Diversité des Auteurs 
                        <span class="float-right">{{ authorsProgress }}%</span>
                    </h4>
                    <div class="progress mb-4">
                        <div class="progress-bar bg-warning" role="progressbar" style="width: {{ authorsProgress }}%" 
                             aria-valuenow="{{ authorsProgress }}" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>

                    {% set targetCategories = 20 %}
                    {% set categoriesProgress = (categories|length / targetCategories * 100)|round %}
                    <h4 class="small font-weight-bold">
                        Couverture Catégorielle 
                        <span class="float-right">{{ categoriesProgress }}%</span>
                    </h4>
                    <div class="progress mb-4">
                        <div class="progress-bar bg-info" role="progressbar" style="width: {{ categoriesProgress }}%" 
                             aria-valuenow="{{ categoriesProgress }}" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>

                    {% set targetPublishers = 15 %}
                    {% set publishersProgress = (editeurs|length / targetPublishers * 100)|round %}
                    <h4 class="small font-weight-bold">
                        Partenariats Éditeurs 
                        <span class="float-right">{{ publishersProgress }}%</span>
                    </h4>
                    <div class="progress mb-4">
                        <div class="progress-bar bg-primary" role="progressbar" style="width: {{ publishersProgress }}%" 
                             aria-valuenow="{{ publishersProgress }}" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>

                    {% set stockCompletion = 0 %}
                    {% set totalStock = 0 %}
                    {% for livre in livres %}
                        {% set totalStock = totalStock + livre.nbExemplaires %}
                    {% endfor %}
                    {% set stockCompletion = (totalStock / (livres|length * 10) * 100)|round %}
                    <h4 class="small font-weight-bold">
                        Stock Moyen 
                        <span class="float-right">{{ stockCompletion }}%</span>
                    </h4>
                    <div class="progress">
                        <div class="progress-bar bg-success" role="progressbar" style="width: {{ stockCompletion }}%" 
                             aria-valuenow="{{ stockCompletion }}" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Top Authors -->
        <div class="col-lg-6 mb-4">
            <div class="card shadow h-100">
                <div class="card-header py-3 bg-light">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-star mr-2"></i>Auteurs les Plus Représentés
                    </h6>
                </div>
                <div class="card-body">
                    {% for author in booksByAuthor|slice(0, 5) %}
                        {% set progressWidth = (author.count / livres|length * 100)|round %}
                        <h4 class="small font-weight-bold">
                            {{ author.author }} 
                            <span class="float-right">{{ author.count }} livre(s)</span>
                        </h4>
                        <div class="progress mb-4">
                            <div class="progress-bar bg-primary" role="progressbar" 
                                 style="width: {{ progressWidth }}%" 
                                 aria-valuenow="{{ progressWidth }}" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                    {% else %}
                        <div class="text-center py-5">
                            <i class="fas fa-info-circle fa-3x text-gray-300 mb-3"></i>
                            <p class="text-muted">Aucun auteur trouvé.</p>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <!-- User Management Section -->
    <div class="row mb-4">
        <!-- User Statistics -->
        <div class="col-xl-4 col-lg-6 mb-4">
            <div class="card border-left-info shadow h-100 py-2 hover-card">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                Utilisateurs Actifs
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">12</div>
                            <div class="text-xs text-muted mt-1">
                                <i class="fas fa-users text-success mr-1"></i>3 nouveaux ce mois
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-users fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Admin Users -->
        <div class="col-xl-4 col-lg-6 mb-4">
            <div class="card border-left-danger shadow h-100 py-2 hover-card">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-danger text-uppercase mb-1">
                                Administrateurs
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">2</div>
                            <div class="text-xs text-muted mt-1">
                                <i class="fas fa-user-shield text-warning mr-1"></i>Accès complet
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-user-shield fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Moderator Users -->
        <div class="col-xl-4 col-lg-6 mb-4">
            <div class="card border-left-warning shadow h-100 py-2 hover-card">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                Modérateurs
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">5</div>
                            <div class="text-xs text-muted mt-1">
                                <i class="fas fa-user-edit text-info mr-1"></i>Gestion partielle
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-user-edit fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- User Activity and System Info -->
    <div class="row mb-4">
        <!-- Recent User Activity -->
        <div class="col-xl-8 col-lg-7 mb-4">
            <div class="card shadow h-100">
                <div class="card-header py-3 bg-light">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-user-clock mr-2"></i>Activité Utilisateurs Récente
                    </h6>
                </div>
                <div class="card-body">
                    <div class="timeline">
                        <div class="timeline-item">
                            <div class="timeline-marker bg-success"></div>
                            <div class="timeline-content">
                                <h6 class="timeline-title">Nouveau livre ajouté</h6>
                                <p class="timeline-text">Admin a ajouté "Le Petit Prince" à la collection</p>
                                <small class="text-muted">Il y a 2 heures</small>
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-marker bg-info"></div>
                            <div class="timeline-content">
                                <h6 class="timeline-title">Utilisateur inscrit</h6>
                                <p class="timeline-text">Marie Dupont s'est inscrite sur la plateforme</p>
                                <small class="text-muted">Il y a 5 heures</small>
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-marker bg-warning"></div>
                            <div class="timeline-content">
                                <h6 class="timeline-title">Modification auteur</h6>
                                <p class="timeline-text">Modérateur a modifié les informations de Victor Hugo</p>
                                <small class="text-muted">Hier</small>
                            </div>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-marker bg-primary"></div>
                            <div class="timeline-content">
                                <h6 class="timeline-title">Rapport généré</h6>
                                <p class="timeline-text">Rapport mensuel des statistiques téléchargé</p>
                                <small class="text-muted">Il y a 2 jours</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Information -->
        <div class="col-xl-4 col-lg-5 mb-4">
            <div class="card shadow h-100">
                <div class="card-header py-3 bg-light">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-server mr-2"></i>Informations Système
                    </h6>
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-6">
                            <div class="text-center p-3 bg-light rounded">
                                <i class="fas fa-database fa-2x text-primary mb-2"></i>
                                <h6 class="text-primary mb-1">OK</h6>
                                <small class="text-muted">Base de données</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="text-center p-3 bg-light rounded">
                                <i class="fas fa-hdd fa-2x text-success mb-2"></i>
                                <h6 class="text-success mb-1">2.3GB</h6>
                                <small class="text-muted">Espace utilisé</small>
                            </div>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-6">
                            <div class="text-center p-3 bg-light rounded">
                                <i class="fas fa-clock fa-2x text-info mb-2"></i>
                                <h6 class="text-info mb-1">99.9%</h6>
                                <small class="text-muted">Disponibilité</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="text-center p-3 bg-light rounded">
                                <i class="fas fa-shield-alt fa-2x text-warning mb-2"></i>
                                <h6 class="text-warning mb-1">Sécurisé</h6>
                                <small class="text-muted">Statut sécurité</small>
                            </div>
                        </div>
                    </div>

                    <hr>

                    <div class="text-center">
                        <small class="text-muted d-block mb-2">Dernière sauvegarde</small>
                        <span class="badge badge-success">Aujourd'hui 02:00</span>
                    </div>

                    <div class="text-center mt-3">
                        <small class="text-muted d-block mb-2">Version système</small>
                        <span class="badge badge-primary">Biblio v2.1.0</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions for Admin -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow">
                <div class="card-header py-3 bg-light">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-bolt mr-2"></i>Actions Rapides
                    </h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3 col-sm-6 mb-3">
                            <a href="{{ path('admin', {'entity': 'User'}) }}" class="btn btn-outline-primary btn-block">
                                <i class="fas fa-users mr-2"></i>Gérer Utilisateurs
                            </a>
                        </div>
                        <div class="col-md-3 col-sm-6 mb-3">
                            <a href="{{ path('admin', {'entity': 'Livre'}) }}" class="btn btn-outline-success btn-block">
                                <i class="fas fa-book mr-2"></i>Gérer Livres
                            </a>
                        </div>
                        <div class="col-md-3 col-sm-6 mb-3">
                            <a href="{{ path('admin', {'entity': 'Auteur'}) }}" class="btn btn-outline-info btn-block">
                                <i class="fas fa-user mr-2"></i>Gérer Auteurs
                            </a>
                        </div>
                        <div class="col-md-3 col-sm-6 mb-3">
                            <a href="{{ path('api_inspection_activity_logs') }}" class="btn btn-outline-warning btn-block">
                                <i class="fas fa-history mr-2"></i>Voir Logs
                            </a>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-md-3 col-sm-6 mb-3">
                            <a href="{{ path('admin', {'entity': 'ReadingProgress'}) }}" class="btn btn-outline-info btn-block">
                                <i class="fas fa-book-reader mr-2"></i>Gérer Progressions
                            </a>
                        </div>
                        <div class="col-md-3 col-sm-6 mb-3">
                            <a href="{{ path('admin', {'entity': 'Review'}) }}" class="btn btn-outline-success btn-block">
                                <i class="fas fa-star mr-2"></i>Gérer Avis
                            </a>
                        </div>
                        <div class="col-md-3 col-sm-6 mb-3">
                            <a href="{{ path('admin', {'entity': 'ReadingGoal'}) }}" class="btn btn-outline-primary btn-block">
                                <i class="fas fa-bullseye mr-2"></i>Gérer Objectifs
                            </a>
                        </div>
                        <div class="col-md-3 col-sm-6 mb-3">
                            <a href="{{ path('admin', {'entity': 'Categorie'}) }}" class="btn btn-outline-secondary btn-block">
                                <i class="fas fa-tags mr-2"></i>Gérer Catégories
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Chart.js Scripts -->
    <script>
    (function() {
        // Store chart data from Twig
        var monthlyData = {{ monthlyData|json_encode|raw }};
        var chartLabels = {{ chartData|map(c => c.label)|json_encode|raw }};
        var chartCounts = {{ chartData|map(c => c.count)|json_encode|raw }};
        var statsData = [{{ livres|length }}, {{ auteurs|length }}, {{ categories|length }}, {{ editeurs|length }}];

        function number_format(number, decimals, dec_point, thousands_sep) {
            number = (number + '').replace(',', '').replace(' ', '');
            var n = !isFinite(+number) ? 0 : +number,
                prec = !isFinite(+decimals) ? 0 : Math.abs(decimals),
                sep = (typeof thousands_sep === 'undefined') ? ',' : thousands_sep,
                dec = (typeof dec_point === 'undefined') ? '.' : dec_point,
                s = '',
                toFixedFix = function (n, prec) {
                    var k = Math.pow(10, prec);
                    return '' + Math.round(n * k) / k;
                };
            s = (prec ? toFixedFix(n, prec) : '' + Math.round(n)).split('.');
            if (s[0].length > 3) {
                s[0] = s[0].replace(/\B(?=(?:\d{3})+(?!\d))/g, sep);
            }
            if ((s[1] || '').length < prec) {
                s[1] = s[1] || '';
                s[1] += new Array(prec - s[1].length + 1).join('0');
            }
            return s.join(dec);
        }

        function initDashboardCharts() {
            // Destroy existing charts if they exist
            if (window.dashLineChart) { window.dashLineChart.destroy(); }
            if (window.dashBarChart) { window.dashBarChart.destroy(); }
            if (window.dashPieChart) { window.dashPieChart.destroy(); }

            // Set default font
            Chart.defaults.font.family = 'Nunito, -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif';
            Chart.defaults.color = '#858796';

            // Area Chart
            var ctxArea = document.getElementById("myAreaChart");
            if (ctxArea) {
                window.dashLineChart = new Chart(ctxArea, {
                    type: 'line',
                    data: {
                        labels: ["Jan", "Fév", "Mar", "Avr", "Mai", "Jun", "Jul", "Aoû", "Sep", "Oct", "Nov", "Déc"],
                        datasets: [{
                            label: "Livres ajoutés",
                            lineTension: 0.3,
                            backgroundColor: "rgba(111, 66, 193, 0.05)",
                            borderColor: "rgba(111, 66, 193, 1)",
                            pointRadius: 3,
                            pointBackgroundColor: "rgba(111, 66, 193, 1)",
                            pointBorderColor: "rgba(111, 66, 193, 1)",
                            pointHoverRadius: 5,
                            pointHoverBackgroundColor: "rgba(111, 66, 193, 1)",
                            pointHoverBorderColor: "rgba(111, 66, 193, 1)",
                            pointHitRadius: 10,
                            pointBorderWidth: 2,
                            data: monthlyData,
                        }],
                    },
                    options: {
                        maintainAspectRatio: false,
                        layout: { padding: { left: 10, right: 25, top: 25, bottom: 0 } },
                        scales: {
                            x: { grid: { display: false, drawBorder: false }, ticks: { maxTicksLimit: 12 } },
                            y: {
                                ticks: { maxTicksLimit: 5, padding: 10, callback: function(value) { return number_format(value); } },
                                grid: { color: "rgb(234, 236, 244)", borderDash: [2], drawBorder: false }
                            }
                        },
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                backgroundColor: "rgb(255,255,255)", bodyColor: "#858796", titleMarginBottom: 10, titleColor: '#6c757d',
                                titleFont: { size: 14 }, borderColor: '#dddfeb', borderWidth: 1, padding: 15, displayColors: false,
                                intersect: false, mode: 'index', caretPadding: 10,
                                callbacks: { label: function(context) { return 'Livres ajoutés: ' + number_format(context.parsed.y); } }
                            }
                        }
                    }
                });
            }

            // Bar Chart
            var ctxBar = document.getElementById("myBarChart");
            if (ctxBar) {
                window.dashBarChart = new Chart(ctxBar, {
                    type: 'bar',
                    data: {
                        labels: ["Livres", "Auteurs", "Catégories", "Éditeurs"],
                        datasets: [{ label: "Nombre", backgroundColor: "#6f42c1", hoverBackgroundColor: "#5a32a3", borderColor: "#6f42c1", data: statsData }],
                    },
                    options: {
                        maintainAspectRatio: false,
                        layout: { padding: { left: 10, right: 25, top: 25, bottom: 0 } },
                        scales: {
                            x: { grid: { display: false, drawBorder: false }, ticks: { maxTicksLimit: 6 } },
                            y: {
                                ticks: { min: 0, maxTicksLimit: 5, padding: 10, callback: function(value) { return number_format(value); } },
                                grid: { color: "rgb(234, 236, 244)", borderDash: [2], drawBorder: false }
                            }
                        },
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                titleMarginBottom: 10, titleColor: '#6e707e', titleFont: { size: 14 },
                                backgroundColor: "rgb(255,255,255)", bodyColor: "#858796", borderColor: '#dddfeb', borderWidth: 1,
                                padding: 15, displayColors: false, caretPadding: 10,
                                callbacks: { label: function(context) { return 'Nombre: ' + number_format(context.parsed.y); } }
                            }
                        }
                    }
                });
            }

            // Pie Chart
            var ctxPie = document.getElementById("myPieChart");
            if (ctxPie) {
                window.dashPieChart = new Chart(ctxPie, {
                    type: 'doughnut',
                    data: {
                        labels: chartLabels,
                        datasets: [{
                            data: chartCounts,
                            backgroundColor: ['#6f42c1', '#9c27b0', '#ba68c8', '#f6c23e', '#e74a3b', '#858796'],
                            hoverBackgroundColor: ['#5a32a3', '#8e24aa', '#ab47bc', '#f4b619', '#e02d1b', '#6c757d'],
                            hoverBorderColor: "rgba(234, 236, 244, 1)",
                        }],
                    },
                    options: {
                        maintainAspectRatio: false,
                        plugins: {
                            tooltip: {
                                backgroundColor: "rgb(255,255,255)", bodyColor: "#858796", borderColor: '#dddfeb',
                                borderWidth: 1, padding: 15, displayColors: false, caretPadding: 10,
                                callbacks: { label: function(context) { return context.label + ': ' + context.parsed; } }
                            },
                            legend: { display: false }
                        },
                        cutout: '70%',
                    },
                });
            }
        }

        // Wait for Chart.js to be available then init
        function waitForChartAndInit() {
            if (typeof Chart !== 'undefined') {
                initDashboardCharts();
            } else {
                setTimeout(waitForChartAndInit, 50);
            }
        }

        // Run immediately
        waitForChartAndInit();
    })();
    </script>

    <!-- Custom Styles -->
    <style>
        /* Hover effects for cards */
        .hover-card {
            transition: all 0.3s ease;
        }

        .hover-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0.5rem 1.5rem rgba(0, 0, 0, 0.15) !important;
        }

        /* Hover effect for recent activity items */
        .hover-item {
            transition: all 0.2s ease;
        }

        .hover-item:hover {
            background-color: #e9ecef !important;
        }

        /* Scroll container for sliders */
        .scroll-container {
            display: flex;
            overflow-x: auto;
            overflow-y: hidden;
            gap: 1rem;
            padding-bottom: 0.5rem;
            scrollbar-width: thin;
            scrollbar-color: #c1c1c1 #f1f1f1;
        }

        .scroll-container::-webkit-scrollbar {
            height: 8px;
        }

        .scroll-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .scroll-container::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        .scroll-container::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        /* Prevent card shrinking in scroll container */
        .scroll-container .card {
            flex-shrink: 0;
        }

        /* Better spacing for mobile */
        @media (max-width: 768px) {
            .scroll-container {
                gap: 0.75rem;
            }

            .scroll-container .card {
                min-width: 240px !important;
                max-width: 240px !important;
            }
        }

        /* Gradient background for primary cards */
        .bg-gradient-primary {
            background: linear-gradient(135deg, #4e73df 0%, #224abe 100%);
        }

        /* Chart containers */
        .chart-area,
        .chart-bar,
        .chart-pie {
            position: relative;
        }

        /* Better progress bar animations */
        .progress-bar {
            transition: width 1s ease-in-out;
        }

        /* Card border styles */
        .border-left-primary {
            border-left: 0.25rem solid #4e73df !important;
        }

        .border-left-success {
            border-left: 0.25rem solid #1cc88a !important;
        }

        .border-left-info {
            border-left: 0.25rem solid #36b9cc !important;
        }

        .border-left-warning {
            border-left: 0.25rem solid #f6c23e !important;
        }

        /* Improved card header */
        .card-header.bg-light {
            background-color: #f8f9fc !important;
            border-bottom: 1px solid #e3e6f0;
        }

        /* Better spacing for icons */
        .card-body i.fa-2x,
        .card-body i.fa-3x {
            opacity: 0.8;
        }

        /* Smooth transitions */
        * {
            transition: background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }

        /* Remove transition from charts */
        canvas {
            transition: none !important;
        }

        /* Timeline styles */
        .timeline {
            position: relative;
            padding-left: 30px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #e9ecef;
        }

        .timeline-item {
            position: relative;
            margin-bottom: 30px;
        }

        .timeline-item:last-child {
            margin-bottom: 0;
        }

        .timeline-marker {
            position: absolute;
            left: -22px;
            top: 5px;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            border: 2px solid #fff;
            box-shadow: 0 0 0 2px #e9ecef;
        }

        .timeline-content {
            background: #f8f9fc;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4e73df;
        }

        .timeline-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 5px;
            color: #5a5c69;
        }

        .timeline-text {
            font-size: 13px;
            color: #6c757d;
            margin-bottom: 5px;
        }
    </style>
{% endblock %}