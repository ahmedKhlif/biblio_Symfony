{% extends 'backendofficebase.html.twig' %}

{% block title %}Recherche: {{ query }}{% endblock %}

{% block body %}
<div class="container-fluid">
    <!-- Page Heading -->
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-gray-800">
            <i class="fas fa-search mr-2"></i>Résultats de recherche
        </h1>
    </div>

    <!-- Search Info -->
    <div class="card shadow mb-4">
        <div class="card-body">
            <div class="d-flex align-items-center">
                <div class="mr-3">
                    <div class="icon-circle bg-primary text-white">
                        <i class="fas fa-search"></i>
                    </div>
                </div>
                <div>
                    <h5 class="mb-1">Recherche pour: <strong>"{{ query }}"</strong></h5>
                    <p class="mb-0 text-muted">{{ totalResults }} résultat(s) trouvé(s)</p>
                </div>
            </div>
        </div>
    </div>

    {% if query|length < 2 %}
        <div class="alert alert-warning">
            <i class="fas fa-exclamation-triangle mr-2"></i>
            Veuillez entrer au moins 2 caractères pour effectuer une recherche.
        </div>
    {% elseif totalResults == 0 %}
        <div class="alert alert-info">
            <i class="fas fa-info-circle mr-2"></i>
            Aucun résultat trouvé pour "<strong>{{ query }}</strong>". Essayez avec d'autres mots-clés.
        </div>
    {% else %}
        <div class="row">
            <!-- Books Results -->
            {% if results.livres|length > 0 %}
            <div class="col-lg-8 mb-4">
                <div class="card shadow h-100">
                    <div class="card-header py-3 bg-primary text-white">
                        <h6 class="m-0 font-weight-bold">
                            <i class="fas fa-book mr-2"></i>Livres ({{ results.livres|length }})
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="list-group list-group-flush">
                            {% for livre in results.livres %}
                            <a href="{{ path('app_livre_show', {'id': livre.id}) }}" class="list-group-item list-group-item-action d-flex align-items-center">
                                <div class="mr-3">
                                    {% if livre.image %}
                                        <img src="{{ asset('uploads/images/' ~ livre.image) }}" alt="{{ livre.titre }}" class="rounded" style="width: 50px; height: 70px; object-fit: cover;">
                                    {% else %}
                                        <div class="bg-light rounded d-flex align-items-center justify-content-center" style="width: 50px; height: 70px;">
                                            <i class="fas fa-book text-muted"></i>
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="flex-grow-1">
                                    <h6 class="mb-1 text-primary">{{ livre.titre }}</h6>
                                    <p class="mb-0 small text-muted">
                                        <i class="fas fa-user mr-1"></i>{{ livre.auteur.prenom }} {{ livre.auteur.nom }}
                                        <span class="mx-2">|</span>
                                        <i class="fas fa-folder mr-1"></i>{{ livre.categorie.designation }}
                                    </p>
                                </div>
                                <div class="text-right">
                                    <span class="badge badge-info">{{ livre.prix }} DT</span>
                                </div>
                            </a>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Sidebar Results -->
            <div class="col-lg-4">
                <!-- Authors -->
                {% if results.auteurs|length > 0 %}
                <div class="card shadow mb-4">
                    <div class="card-header py-3 bg-success text-white">
                        <h6 class="m-0 font-weight-bold">
                            <i class="fas fa-user-edit mr-2"></i>Auteurs ({{ results.auteurs|length }})
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="list-group list-group-flush">
                            {% for auteur in results.auteurs %}
                            <a href="{{ path('app_auteur_show', {'id': auteur.id}) }}" class="list-group-item list-group-item-action">
                                <i class="fas fa-user mr-2 text-success"></i>
                                {{ auteur.prenom }} {{ auteur.nom }}
                            </a>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Categories -->
                {% if results.categories|length > 0 %}
                <div class="card shadow mb-4">
                    <div class="card-header py-3 bg-warning text-white">
                        <h6 class="m-0 font-weight-bold">
                            <i class="fas fa-folder mr-2"></i>Catégories ({{ results.categories|length }})
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="list-group list-group-flush">
                            {% for categorie in results.categories %}
                            <a href="{{ path('app_categorie_show', {'id': categorie.id}) }}" class="list-group-item list-group-item-action">
                                <i class="fas fa-folder mr-2 text-warning"></i>
                                {{ categorie.designation }}
                            </a>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Users (Admin only) -->
                {% if results.users|length > 0 %}
                <div class="card shadow mb-4">
                    <div class="card-header py-3 bg-info text-white">
                        <h6 class="m-0 font-weight-bold">
                            <i class="fas fa-users mr-2"></i>Utilisateurs ({{ results.users|length }})
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="list-group list-group-flush">
                            {% for user in results.users %}
                            <a href="{{ path('admin', {'crudAction': 'detail', 'crudControllerFqcn': 'App\\\\Controller\\\\Admin\\\\UserCrudController', 'entityId': user.id}) }}" class="list-group-item list-group-item-action">
                                <div class="d-flex align-items-center">
                                    {% if user.profilePicture %}
                                        <img src="{{ asset('uploads/profile_pictures/' ~ user.profilePicture) }}" alt="" class="rounded-circle mr-2" style="width: 30px; height: 30px; object-fit: cover;">
                                    {% else %}
                                        <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center mr-2" style="width: 30px; height: 30px; font-size: 12px;">
                                            {{ user.firstName|default('U')|first|upper }}{{ user.lastName|default('')|first|upper }}
                                        </div>
                                    {% endif %}
                                    <div>
                                        <span>{{ user.firstName }} {{ user.lastName }}</span>
                                        <br><small class="text-muted">{{ user.email }}</small>
                                    </div>
                                </div>
                            </a>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}
