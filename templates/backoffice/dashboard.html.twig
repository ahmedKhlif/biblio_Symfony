{% extends 'backendofficebase.html.twig' %}

{% block title %}Dashboard - Biblio Admin{% endblock %}

{% block body %}
    <!-- Page Heading -->
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <div>
            <h1 class="h3 mb-0 text-gray-800">
                <i class="fas fa-tachometer-alt text-primary mr-2"></i>Tableau de Bord
            </h1>
            <p class="mb-0 text-muted">Aperçu général de votre bibliothèque</p>
        </div>
        <div>
            <a href="{{ path('app_livre_new') }}" class="d-none d-sm-inline-block btn btn-success btn-sm shadow-sm mr-2">
                <i class="fas fa-plus fa-sm text-white-50"></i> Nouveau Livre
            </a>
            <a href="#" class="d-none d-sm-inline-block btn btn-primary btn-sm shadow-sm">
                <i class="fas fa-download fa-sm text-white-50"></i> Rapport
            </a>
        </div>
    </div>

    <!-- Welcome Banner -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card bg-gradient-primary text-white shadow">
                <div class="card-body py-4">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h4 class="font-weight-bold mb-2">
                                <i class="fas fa-book-open mr-2"></i>Bienvenue dans votre Bibliothèque
                            </h4>
                            <p class="mb-0" style="opacity: 0.9;">
                                Gérez efficacement vos {{ livres|length }} livres, {{ auteurs|length }} auteurs,
                                {{ categories|length }} catégories et {{ editeurs|length }} éditeurs.
                            </p>
                        </div>
                        <div class="col-md-4 text-right d-none d-md-block">
                            <i class="fas fa-chart-line fa-4x" style="opacity: 0.3;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Key Metrics Row -->
    <div class="row mb-4">
        <!-- Total Books Card -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-primary shadow h-100 py-2 hover-card">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                Collection Totale
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ livres|length }}</div>
                            <div class="text-xs text-muted mt-1">
                                <i class="fas fa-arrow-up text-success mr-1"></i>+12% ce mois
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-book fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Total Authors Card -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-success shadow h-100 py-2 hover-card">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                Auteurs Actifs
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ auteurs|length }}</div>
                            <div class="text-xs text-muted mt-1">
                                <i class="fas fa-users text-info mr-1"></i>Diversité littéraire
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-user fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Total Categories Card -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-info shadow h-100 py-2 hover-card">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                Genres Littéraires
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ categories|length }}</div>
                            <div class="text-xs text-muted mt-1">
                                <i class="fas fa-tags text-warning mr-1"></i>Catégories organisées
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-tags fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Total Publishers Card -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-warning shadow h-100 py-2 hover-card">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                Partenaires Éditeurs
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ editeurs|length }}</div>
                            <div class="text-xs text-muted mt-1">
                                <i class="fas fa-handshake text-primary mr-1"></i>Collaborations actives
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-building fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts Row -->
    <div class="row mb-4">
        <!-- Area Chart -->
        <div class="col-xl-8 col-lg-7 mb-4">
            <div class="card shadow h-100">
                <div class="card-header py-3 bg-light">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-chart-area mr-2"></i>Évolution des Ajouts de Livres
                    </h6>
                </div>
                <div class="card-body">
                    <div class="chart-area" style="position: relative; height: 320px;">
                        <canvas id="myAreaChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pie Chart -->
        <div class="col-xl-4 col-lg-5 mb-4">
            <div class="card shadow h-100">
                <div class="card-header py-3 bg-light">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-chart-pie mr-2"></i>Répartition par Catégorie
                    </h6>
                </div>
                <div class="card-body">
                    <div class="chart-pie" style="position: relative; height: 240px;">
                        <canvas id="myPieChart"></canvas>
                    </div>
                    <div class="mt-4 text-center small">
                        {% for item in chartData %}
                            <span class="mr-2 mb-2 d-inline-block">
                                <i class="fas fa-circle" style="color: {{ ['#4e73df', '#1cc88a', '#36b9cc', '#f6c23e', '#e74a3b', '#858796'][loop.index0 % 6] }}"></i>
                                {{ item.label }} ({{ item.count }})
                            </span>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bar Chart and Activity -->
    <div class="row mb-4">
        <!-- Bar Chart -->
        <div class="col-xl-6 col-lg-6 mb-4">
            <div class="card shadow h-100">
                <div class="card-header py-3 bg-light d-flex justify-content-between align-items-center">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-chart-bar mr-2"></i>Répartition par Entité
                    </h6>
                </div>
                <div class="card-body">
                    <div class="chart-bar" style="position: relative; height: 300px;">
                        <canvas id="myBarChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Library Activity -->
        <div class="col-xl-6 col-lg-6 mb-4">
            <div class="card shadow h-100">
                <div class="card-header py-3 bg-light">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-chart-line mr-2"></i>Activité de la Bibliothèque
                    </h6>
                </div>
                <div class="card-body">
                    {% set totalExemplaires = 0 %}
                    {% set totalValeur = 0 %}
                    {% for livre in livres %}
                        {% set totalExemplaires = totalExemplaires + livre.nbExemplaires %}
                        {% set totalValeur = totalValeur + (livre.prix * livre.nbExemplaires) %}
                    {% endfor %}

                    <div class="row mb-4">
                        <div class="col-6">
                            <div class="text-center p-3 bg-light rounded">
                                <i class="fas fa-copy fa-2x text-primary mb-2"></i>
                                <h4 class="text-primary mb-1">{{ totalExemplaires }}</h4>
                                <small class="text-muted">Exemplaires physiques</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="text-center p-3 bg-light rounded">
                                <i class="fas fa-euro-sign fa-2x text-success mb-2"></i>
                                <h4 class="text-success mb-1">{{ totalValeur|number_format(0, ',', ' ') }}€</h4>
                                <small class="text-muted">Valeur totale</small>
                            </div>
                        </div>
                    </div>

                    <hr>

                    <div class="row">
                        <div class="col-6">
                            <div class="text-center p-3">
                                <i class="fas fa-book text-info mb-2"></i>
                                <h6 class="text-info mb-1">{{ livres|length }}</h6>
                                <small class="text-muted">Titres uniques</small>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="text-center p-3">
                                <i class="fas fa-user-edit text-warning mb-2"></i>
                                <h6 class="text-warning mb-1">{{ auteurs|length }}</h6>
                                <small class="text-muted">Auteurs représentés</small>
                            </div>
                        </div>
                    </div>

                    <div class="mt-3 p-3 bg-light rounded">
                        <div class="row">
                            <div class="col-6">
                                <i class="fas fa-database text-success mr-2"></i>
                                <small class="text-muted">Base de données: <strong class="text-success">OK</strong></small>
                            </div>
                            <div class="col-6 text-right">
                                <small class="text-muted">MAJ: {{ "now"|date("d/m/Y H:i") }}</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Progress and Top Authors -->
    <div class="row mb-4">
        <!-- Progress Bars -->
        <div class="col-lg-6 mb-4">
            <div class="card shadow h-100">
                <div class="card-header py-3 bg-light">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-tasks mr-2"></i>Progression de la Bibliothèque
                    </h6>
                </div>
                <div class="card-body">
                    {% set targetBooks = 100 %}
                    {% set booksProgress = (livres|length / targetBooks * 100)|round %}
                    <h4 class="small font-weight-bold">
                        Collection de Livres 
                        <span class="float-right">{{ booksProgress }}%</span>
                    </h4>
                    <div class="progress mb-4">
                        <div class="progress-bar bg-danger" role="progressbar" style="width: {{ booksProgress }}%" 
                             aria-valuenow="{{ booksProgress }}" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>

                    {% set targetAuthors = 50 %}
                    {% set authorsProgress = (auteurs|length / targetAuthors * 100)|round %}
                    <h4 class="small font-weight-bold">
                        Diversité des Auteurs 
                        <span class="float-right">{{ authorsProgress }}%</span>
                    </h4>
                    <div class="progress mb-4">
                        <div class="progress-bar bg-warning" role="progressbar" style="width: {{ authorsProgress }}%" 
                             aria-valuenow="{{ authorsProgress }}" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>

                    {% set targetCategories = 20 %}
                    {% set categoriesProgress = (categories|length / targetCategories * 100)|round %}
                    <h4 class="small font-weight-bold">
                        Couverture Catégorielle 
                        <span class="float-right">{{ categoriesProgress }}%</span>
                    </h4>
                    <div class="progress mb-4">
                        <div class="progress-bar bg-info" role="progressbar" style="width: {{ categoriesProgress }}%" 
                             aria-valuenow="{{ categoriesProgress }}" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>

                    {% set targetPublishers = 15 %}
                    {% set publishersProgress = (editeurs|length / targetPublishers * 100)|round %}
                    <h4 class="small font-weight-bold">
                        Partenariats Éditeurs 
                        <span class="float-right">{{ publishersProgress }}%</span>
                    </h4>
                    <div class="progress mb-4">
                        <div class="progress-bar bg-primary" role="progressbar" style="width: {{ publishersProgress }}%" 
                             aria-valuenow="{{ publishersProgress }}" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>

                    {% set stockCompletion = 0 %}
                    {% set totalStock = 0 %}
                    {% for livre in livres %}
                        {% set totalStock = totalStock + livre.nbExemplaires %}
                    {% endfor %}
                    {% set stockCompletion = (totalStock / (livres|length * 10) * 100)|round %}
                    <h4 class="small font-weight-bold">
                        Stock Moyen 
                        <span class="float-right">{{ stockCompletion }}%</span>
                    </h4>
                    <div class="progress">
                        <div class="progress-bar bg-success" role="progressbar" style="width: {{ stockCompletion }}%" 
                             aria-valuenow="{{ stockCompletion }}" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Top Authors -->
        <div class="col-lg-6 mb-4">
            <div class="card shadow h-100">
                <div class="card-header py-3 bg-light">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-star mr-2"></i>Auteurs les Plus Représentés
                    </h6>
                </div>
                <div class="card-body">
                    {% for author in booksByAuthor|slice(0, 5) %}
                        {% set progressWidth = (author.count / livres|length * 100)|round %}
                        <h4 class="small font-weight-bold">
                            {{ author.author }} 
                            <span class="float-right">{{ author.count }} livre(s)</span>
                        </h4>
                        <div class="progress mb-4">
                            <div class="progress-bar bg-primary" role="progressbar" 
                                 style="width: {{ progressWidth }}%" 
                                 aria-valuenow="{{ progressWidth }}" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                    {% else %}
                        <div class="text-center py-5">
                            <i class="fas fa-info-circle fa-3x text-gray-300 mb-3"></i>
                            <p class="text-muted">Aucun auteur trouvé.</p>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Activity -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow">
                <div class="card-header py-3 bg-light">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-history mr-2"></i>Activité Récente
                    </h6>
                </div>
                <div class="card-body">
                    {% for livre in derniersLivres %}
                        <div class="d-flex align-items-center mb-3 p-3 bg-light rounded hover-item">
                            <div class="mr-3">
                                {% if livre.image %}
                                    <img src="{{ asset('uploads/images/' ~ livre.image) }}" 
                                         alt="{{ livre.titre }}" 
                                         class="rounded" 
                                         style="width: 60px; height: 80px; object-fit: cover;">
                                {% else %}
                                    <div class="bg-primary text-white rounded d-flex align-items-center justify-content-center" 
                                         style="width: 60px; height: 80px;">
                                        <i class="fas fa-book fa-2x"></i>
                                    </div>
                                {% endif %}
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="font-weight-bold mb-1">
                                    <i class="fas fa-book text-primary mr-2"></i>{{ livre.titre }}
                                </h6>
                                <small class="text-muted d-block">
                                    <i class="fas fa-user text-success mr-1"></i>
                                    {{ livre.auteur ? livre.auteur.prenom ~ ' ' ~ livre.auteur.nom : 'Auteur inconnu' }}
                                </small>
                                <small class="text-muted">
                                    <i class="fas fa-tag text-info mr-1"></i>{{ livre.categorie ? livre.categorie.designation : 'N/A' }} •
                                    <i class="fas fa-euro-sign text-warning mr-1"></i>{{ livre.prix|number_format(2, ',', ' ') }} €
                                </small>
                            </div>
                            <div class="text-right">
                                <small class="text-muted d-block mb-2">
                                    <i class="fas fa-calendar text-secondary mr-1"></i>{{ livre.dateEdition|date('d/m/Y') }}
                                </small>
                                <a href="{{ path('app_livre_show', {'id': livre.id}) }}" 
                                   class="btn btn-sm btn-primary">
                                    <i class="fas fa-eye"></i>
                                </a>
                            </div>
                        </div>
                        {% if not loop.last %}<hr class="my-2">{% endif %}
                    {% else %}
                        <div class="text-center py-5">
                            <i class="fas fa-info-circle fa-3x text-gray-300 mb-3"></i>
                            <p class="text-muted">Aucune activité récente trouvée.</p>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <!-- Sliders Section -->
    <div class="row mb-4">
        <!-- Latest Books Slider -->
        <div class="col-12 mb-4">
            <div class="card shadow">
                <div class="card-header py-3 bg-light">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-book mr-2"></i>Derniers Livres Ajoutés
                    </h6>
                </div>
                <div class="card-body p-3">
                    <div class="scroll-container">
                        {% for livre in derniersLivres %}
                            <div class="card shadow-sm border-left-primary hover-card" style="min-width: 280px; max-width: 280px;">
                                <div class="card-header bg-gradient-primary text-white text-center py-2">
                                    <h6 class="font-weight-bold mb-0 small">
                                        {{ livre.titre|slice(0, 30) ~ (livre.titre|length > 30 ? '...' : '') }}
                                    </h6>
                                </div>
                                <div class="card-body p-3">
                                    {% if livre.image %}
                                        <img src="{{ asset('uploads/images/' ~ livre.image) }}" 
                                             alt="{{ livre.titre }}" 
                                             class="img-fluid rounded mb-2" 
                                             style="height: 140px; width: 100%; object-fit: cover;">
                                    {% else %}
                                        <div class="text-center mb-2 bg-light rounded" style="height: 140px; display: flex; align-items: center; justify-content: center;">
                                            <i class="fas fa-book fa-3x text-gray-300"></i>
                                        </div>
                                    {% endif %}

                                    <div class="mb-2">
                                        <small class="text-muted d-block">
                                            <i class="fas fa-user text-primary mr-1"></i>
                                            <strong>{{ livre.auteur ? livre.auteur.prenom ~ ' ' ~ livre.auteur.nom : 'Auteur inconnu' }}</strong>
                                        </small>
                                        <small class="text-muted d-block">
                                            <i class="fas fa-tag text-info mr-1"></i>
                                            {{ livre.categorie ? livre.categorie.designation : 'N/A' }}
                                        </small>
                                    </div>

                                    <div class="row text-center mb-2">
                                        <div class="col-6">
                                            <small class="text-muted d-block">Prix</small>
                                            <span class="font-weight-bold text-success">{{ livre.prix }} €</span>
                                        </div>
                                        <div class="col-6">
                                            <small class="text-muted d-block">Stock</small>
                                            {% if livre.nbExemplaires > 0 %}
                                                <span class="badge badge-success">{{ livre.nbExemplaires }}</span>
                                            {% else %}
                                                <span class="badge badge-danger">Épuisé</span>
                                            {% endif %}
                                        </div>
                                    </div>

                                    <a href="{{ path('app_livre_show', {'id': livre.id}) }}" 
                                       class="btn btn-primary btn-sm btn-block">
                                        <i class="fas fa-eye mr-1"></i>Voir Détails
                                    </a>
                                </div>
                                <div class="card-footer text-center py-2 bg-light">
                                    <small class="text-muted">
                                        <i class="fas fa-calendar mr-1"></i>{{ livre.dateEdition|date('d/m/Y') }}
                                    </small>
                                </div>
                            </div>
                        {% else %}
                            <div class="col-12 text-center py-5">
                                <i class="fas fa-book fa-3x text-gray-300 mb-3"></i>
                                <h5 class="text-muted">Aucun livre trouvé</h5>
                                <p class="text-muted">Les derniers livres ajoutés apparaîtront ici.</p>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Categories Slider -->
        <div class="col-lg-6 mb-4">
            <div class="card shadow">
                <div class="card-header py-3 bg-light">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-tags mr-2"></i>Catégories Disponibles
                    </h6>
                </div>
                <div class="card-body p-3">
                    <div class="scroll-container">
                        {% for categorie in categories %}
                            <div class="card shadow-sm border-left-info hover-card" style="min-width: 240px; max-width: 240px;">
                                <div class="card-body text-center p-3">
                                    <div class="text-info mb-2">
                                        <i class="fas fa-tag fa-2x"></i>
                                    </div>
                                    <h6 class="card-title font-weight-bold mb-2">{{ categorie.designation }}</h6>
                                    <p class="card-text small text-muted mb-3">
                                        {{ categorie.description|slice(0, 50) ~ '...' }}
                                    </p>
                                    <a href="{{ path('app_categorie_show', {'id': categorie.id}) }}" 
                                       class="btn btn-info btn-sm">
                                        <i class="fas fa-eye mr-1"></i>Voir
                                    </a>
                                </div>
                            </div>
                        {% else %}
                            <div class="col-12 text-center py-4">
                                <i class="fas fa-tags fa-3x text-gray-300 mb-3"></i>
                                <p class="text-muted">Aucune catégorie trouvée</p>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Publishers Slider -->
        <div class="col-lg-6 mb-4">
            <div class="card shadow">
                <div class="card-header py-3 bg-light">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-building mr-2"></i>Éditeurs Partenaires
                    </h6>
                </div>
                <div class="card-body p-3">
                    <div class="scroll-container">
                        {% for editeur in editeurs %}
                            <div class="card shadow-sm border-left-success hover-card" style="min-width: 260px; max-width: 260px;">
                                <div class="card-body p-3">
                                    <div class="d-flex align-items-center mb-2">
                                        <div class="text-success mr-2">
                                            <i class="fas fa-building fa-lg"></i>
                                        </div>
                                        <div class="flex-grow-1">
                                            <h6 class="font-weight-bold mb-0 small">{{ editeur.nomEditeur }}</h6>
                                            <small class="text-muted">
                                                <i class="fas fa-map-marker-alt mr-1"></i>{{ editeur.pays }}
                                            </small>
                                        </div>
                                    </div>
                                    <hr class="my-2">
                                    <div class="row text-center small">
                                        <div class="col-6">
                                            <small class="text-muted d-block">Adresse</small>
                                            <span class="font-weight-bold">{{ editeur.adresse|slice(0, 15) ~ '...' }}</span>
                                        </div>
                                        <div class="col-6">
                                            <small class="text-muted d-block">Tél.</small>
                                            <span class="font-weight-bold small">{{ editeur.telephone }}</span>
                                        </div>
                                    </div>
                                    <div class="text-center mt-3">
                                        <a href="{{ path('app_editeur_show', {'id': editeur.id}) }}" 
                                           class="btn btn-success btn-sm">
                                            <i class="fas fa-eye mr-1"></i>Voir
                                        </a>
                                    </div>
                                </div>
                            </div>
                        {% else %}
                            <div class="col-12 text-center py-4">
                                <i class="fas fa-building fa-3x text-gray-300 mb-3"></i>
                                <p class="text-muted">Aucun éditeur trouvé</p>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Chart.js Scripts -->
    <script>
        // Set new default font family and font color
        Chart.defaults.font.family = 'Nunito, -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif';
        Chart.defaults.color = '#858796';

        function number_format(number, decimals, dec_point, thousands_sep) {
            number = (number + '').replace(',', '').replace(' ', '');
            var n = !isFinite(+number) ? 0 : +number,
                prec = !isFinite(+decimals) ? 0 : Math.abs(decimals),
                sep = (typeof thousands_sep === 'undefined') ? ',' : thousands_sep,
                dec = (typeof dec_point === 'undefined') ? '.' : dec_point,
                s = '',
                toFixedFix = function (n, prec) {
                    var k = Math.pow(10, prec);
                    return '' + Math.round(n * k) / k;
                };
            s = (prec ? toFixedFix(n, prec) : '' + Math.round(n)).split('.');
            if (s[0].length > 3) {
                s[0] = s[0].replace(/\B(?=(?:\d{3})+(?!\d))/g, sep);
            }
            if ((s[1] || '').length < prec) {
                s[1] = s[1] || '';
                s[1] += new Array(prec - s[1].length + 1).join('0');
            }
            return s.join(dec);
        }

        // Area Chart
        var ctxArea = document.getElementById("myAreaChart");
        var myLineChart = new Chart(ctxArea, {
            type: 'line',
            data: {
                labels: ["Jan", "Fév", "Mar", "Avr", "Mai", "Jun", "Jul", "Aoû", "Sep", "Oct", "Nov", "Déc"],
                datasets: [{
                    label: "Livres ajoutés",
                    lineTension: 0.3,
                    backgroundColor: "rgba(78, 115, 223, 0.05)",
                    borderColor: "rgba(78, 115, 223, 1)",
                    pointRadius: 3,
                    pointBackgroundColor: "rgba(78, 115, 223, 1)",
                    pointBorderColor: "rgba(78, 115, 223, 1)",
                    pointHoverRadius: 5,
                    pointHoverBackgroundColor: "rgba(78, 115, 223, 1)",
                    pointHoverBorderColor: "rgba(78, 115, 223, 1)",
                    pointHitRadius: 10,
                    pointBorderWidth: 2,
                    data: {{ monthlyData|json_encode|raw }},
                }],
            },
            options: {
                maintainAspectRatio: false,
                layout: {
                    padding: {
                        left: 10,
                        right: 25,
                        top: 25,
                        bottom: 0
                    }
                },
                scales: {
                    x: {
                        grid: {
                            display: false,
                            drawBorder: false
                        },
                        ticks: {
                            maxTicksLimit: 12
                        }
                    },
                    y: {
                        ticks: {
                            maxTicksLimit: 5,
                            padding: 10,
                            callback: function(value) {
                                return number_format(value);
                        }
                        },
                        grid: {
                            color: "rgb(234, 236, 244)",
                            borderDash: [2],
                            drawBorder: false
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        backgroundColor: "rgb(255,255,255)",
                        bodyColor: "#858796",
                        titleMarginBottom: 10,
                        titleColor: '#6c757d',
                        titleFont: {
                            size: 14
                        },
                        borderColor: '#dddfeb',
                        borderWidth: 1,
                        padding: 15,
                        displayColors: false,
                        intersect: false,
                        mode: 'index',
                        caretPadding: 10,
                        callbacks: {
                            label: function(context) {
                                return 'Livres ajoutés: ' + number_format(context.parsed.y);
                            }
                        }
                    }
                }
            }
        });

        // Bar Chart
        var ctxBar = document.getElementById("myBarChart");
        var myBarChart = new Chart(ctxBar, {
            type: 'bar',
            data: {
                labels: ["Livres", "Auteurs", "Catégories", "Éditeurs"],
                datasets: [{
                    label: "Nombre",
                    backgroundColor: "#4e73df",
                    hoverBackgroundColor: "#2e59d9",
                    borderColor: "#4e73df",
                    data: [{{ livres|length }}, {{ auteurs|length }}, {{ categories|length }}, {{ editeurs|length }}],
                }],
            },
            options: {
                maintainAspectRatio: false,
                layout: {
                    padding: {
                        left: 10,
                        right: 25,
                        top: 25,
                        bottom: 0
                    }
                },
                scales: {
                    x: {
                        grid: {
                            display: false,
                            drawBorder: false
                        },
                        ticks: {
                            maxTicksLimit: 6
                        }
                    },
                    y: {
                        ticks: {
                            min: 0,
                            maxTicksLimit: 5,
                            padding: 10,
                            callback: function(value) {
                                return number_format(value);
                            }
                        },
                        grid: {
                            color: "rgb(234, 236, 244)",
                            borderDash: [2],
                            drawBorder: false
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        titleMarginBottom: 10,
                        titleColor: '#6e707e',
                        titleFont: {
                            size: 14
                        },
                        backgroundColor: "rgb(255,255,255)",
                        bodyColor: "#858796",
                        borderColor: '#dddfeb',
                        borderWidth: 1,
                        padding: 15,
                        displayColors: false,
                        caretPadding: 10,
                        callbacks: {
                            label: function(context) {
                                return 'Nombre: ' + number_format(context.parsed.y);
                            }
                        }
                    }
                }
            }
        });

        // Pie Chart
        var ctxPie = document.getElementById("myPieChart");
        var myPieChart = new Chart(ctxPie, {
            type: 'doughnut',
            data: {
                labels: {{ chartData|map(c => c.label)|json_encode|raw }},
                datasets: [{
                    data: {{ chartData|map(c => c.count)|json_encode|raw }},
                    backgroundColor: ['#4e73df', '#1cc88a', '#36b9cc', '#f6c23e', '#e74a3b', '#858796'],
                    hoverBackgroundColor: ['#2e59d9', '#17a673', '#2c9faf', '#f4b619', '#e02d1b', '#6c757d'],
                    hoverBorderColor: "rgba(234, 236, 244, 1)",
                }],
            },
            options: {
                maintainAspectRatio: false,
                plugins: {
                    tooltip: {
                        backgroundColor: "rgb(255,255,255)",
                        bodyColor: "#858796",
                        borderColor: '#dddfeb',
                        borderWidth: 1,
                        padding: 15,
                        displayColors: false,
                        caretPadding: 10,
                        callbacks: {
                            label: function(context) {
                                return context.label + ': ' + context.parsed;
                            }
                        }
                    },
                    legend: {
                        display: false
                    }
                },
                cutout: '70%',
            },
        });
    </script>

    <!-- Custom Styles -->
    <style>
        /* Hover effects for cards */
        .hover-card {
            transition: all 0.3s ease;
        }

        .hover-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0.5rem 1.5rem rgba(0, 0, 0, 0.15) !important;
        }

        /* Hover effect for recent activity items */
        .hover-item {
            transition: all 0.2s ease;
        }

        .hover-item:hover {
            background-color: #e9ecef !important;
        }

        /* Scroll container for sliders */
        .scroll-container {
            display: flex;
            overflow-x: auto;
            overflow-y: hidden;
            gap: 1rem;
            padding-bottom: 0.5rem;
            scrollbar-width: thin;
            scrollbar-color: #c1c1c1 #f1f1f1;
        }

        .scroll-container::-webkit-scrollbar {
            height: 8px;
        }

        .scroll-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .scroll-container::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        .scroll-container::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        /* Prevent card shrinking in scroll container */
        .scroll-container .card {
            flex-shrink: 0;
        }

        /* Better spacing for mobile */
        @media (max-width: 768px) {
            .scroll-container {
                gap: 0.75rem;
            }
            
            .scroll-container .card {
                min-width: 240px !important;
                max-width: 240px !important;
            }
        }

        /* Gradient background for primary cards */
        .bg-gradient-primary {
            background: linear-gradient(135deg, #4e73df 0%, #224abe 100%);
        }

        /* Chart containers */
        .chart-area,
        .chart-bar,
        .chart-pie {
            position: relative;
        }

        /* Better progress bar animations */
        .progress-bar {
            transition: width 1s ease-in-out;
        }

        /* Card border styles */
        .border-left-primary {
            border-left: 0.25rem solid #4e73df !important;
        }

        .border-left-success {
            border-left: 0.25rem solid #1cc88a !important;
        }

        .border-left-info {
            border-left: 0.25rem solid #36b9cc !important;
        }

        .border-left-warning {
            border-left: 0.25rem solid #f6c23e !important;
        }

        /* Improved card header */
        .card-header.bg-light {
            background-color: #f8f9fc !important;
            border-bottom: 1px solid #e3e6f0;
        }

        /* Better spacing for icons */
        .card-body i.fa-2x,
        .card-body i.fa-3x {
            opacity: 0.8;
        }

        /* Smooth transitions */
        * {
            transition: background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        }

        /* Remove transition from charts */
        canvas {
            transition: none !important;
        }
    </style>
{% endblock %}